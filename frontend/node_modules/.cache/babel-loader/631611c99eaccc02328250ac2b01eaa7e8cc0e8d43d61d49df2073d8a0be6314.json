{"ast":null,"code":"import _objectSpread from\"C:/Users/ashu_/Documents/ecommerce-sim/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{FaBell}from'react-icons/fa';import{useNavigate}from'react-router-dom';import axios from'axios';import'../styles/NotificationBell.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:5000/api';const NotificationBell=()=>{const navigate=useNavigate();const[notifications,setNotifications]=useState([]);const[unreadCount,setUnreadCount]=useState(0);const[showDropdown,setShowDropdown]=useState(false);const[loading,setLoading]=useState(false);const dropdownRef=useRef(null);useEffect(()=>{loadNotifications();const interval=setInterval(loadNotifications,30000);return()=>clearInterval(interval);},[]);useEffect(()=>{const handleClickOutside=event=>{if(dropdownRef.current&&!dropdownRef.current.contains(event.target)){setShowDropdown(false);}};document.addEventListener('mousedown',handleClickOutside);return()=>document.removeEventListener('mousedown',handleClickOutside);},[]);const loadNotifications=async()=>{try{const token=sessionStorage.getItem('token');if(!token)return;setLoading(true);const response=await axios.get(\"\".concat(API_URL,\"/notifications/my-notifications\"),{// ✅ Fix: ruta correcta\nheaders:{Authorization:\"Bearer \".concat(token)}});const notifs=Array.isArray(response.data)?response.data:[];// ✅ Fix: el backend devuelve array directo\nsetNotifications(notifs.slice(0,5));setUnreadCount(notifs.filter(n=>!n.read).length);}catch(error){var _error$response;if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){console.log('⚠️ Token inválido o expirado');}else{console.error('Error al cargar notificaciones:',error);}}finally{setLoading(false);}};const markAsRead=async notificationId=>{try{const token=sessionStorage.getItem('token');await axios.put(\"\".concat(API_URL,\"/notifications/\").concat(notificationId,\"/read\"),{},{headers:{Authorization:\"Bearer \".concat(token)}});setNotifications(prev=>prev.map(n=>n._id===notificationId?_objectSpread(_objectSpread({},n),{},{read:true}):n));setUnreadCount(prev=>Math.max(0,prev-1));}catch(error){console.error('Error al marcar como leída:',error);}};const handleNotificationClick=notification=>{if(!notification.read)markAsRead(notification._id);setShowDropdown(false);if(notification.link){navigate(notification.link);}else if(notification.type==='order'){navigate('/perfil?tab=orders');}};const handleViewAll=()=>{setShowDropdown(false);navigate('/notifications');};return/*#__PURE__*/_jsxs(\"div\",{className:\"notification-bell\",ref:dropdownRef,children:[/*#__PURE__*/_jsxs(\"button\",{className:\"bell-button\",onClick:()=>setShowDropdown(!showDropdown),\"aria-label\":\"Notificaciones\",children:[/*#__PURE__*/_jsx(FaBell,{}),unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{className:\"notification-badge\",children:unreadCount>9?'9+':unreadCount})]}),showDropdown&&/*#__PURE__*/_jsxs(\"div\",{className:\"notification-dropdown\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Notificaciones\"}),unreadCount>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"unread-count\",children:[unreadCount,\" sin leer\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"notification-list\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"notification-loading\",children:\"Cargando...\"}):notifications.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"notification-empty\",children:[/*#__PURE__*/_jsx(FaBell,{size:32,opacity:0.3}),/*#__PURE__*/_jsx(\"p\",{children:\"No tienes notificaciones\"})]}):notifications.map(notif=>/*#__PURE__*/_jsxs(\"div\",{className:\"notification-item \".concat(notif.read?'read':'unread'),onClick:()=>handleNotificationClick(notif),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"notif-content\",children:[/*#__PURE__*/_jsx(\"strong\",{children:notif.title}),/*#__PURE__*/_jsx(\"p\",{children:notif.message}),/*#__PURE__*/_jsx(\"small\",{children:new Date(notif.createdAt).toLocaleString('es-ES',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})})]}),!notif.read&&/*#__PURE__*/_jsx(\"div\",{className:\"unread-dot\"})]},notif._id))}),notifications.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"dropdown-footer\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleViewAll,className:\"view-all-btn\",children:\"Ver todas las notificaciones\"})})]})]});};export default NotificationBell;","map":{"version":3,"names":["React","useState","useEffect","useRef","FaBell","useNavigate","axios","jsx","_jsx","jsxs","_jsxs","API_URL","process","env","REACT_APP_API_URL","NotificationBell","navigate","notifications","setNotifications","unreadCount","setUnreadCount","showDropdown","setShowDropdown","loading","setLoading","dropdownRef","loadNotifications","interval","setInterval","clearInterval","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","token","sessionStorage","getItem","response","get","concat","headers","Authorization","notifs","Array","isArray","data","slice","filter","n","read","length","error","_error$response","status","console","log","markAsRead","notificationId","put","prev","map","_id","_objectSpread","Math","max","handleNotificationClick","notification","link","type","handleViewAll","className","ref","children","onClick","size","opacity","notif","title","message","Date","createdAt","toLocaleString","month","day","hour","minute"],"sources":["C:/Users/ashu_/Documents/ecommerce-sim/frontend/src/components/NotificationBell.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { FaBell } from 'react-icons/fa';\nimport { useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport '../styles/NotificationBell.css';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\n\nconst NotificationBell = () => {\n  const navigate = useNavigate();\n  const [notifications, setNotifications] = useState([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [showDropdown, setShowDropdown] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const dropdownRef = useRef(null);\n\n  useEffect(() => {\n    loadNotifications();\n    const interval = setInterval(loadNotifications, 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n        setShowDropdown(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const loadNotifications = async () => {\n    try {\n      const token = sessionStorage.getItem('token');\n      if (!token) return;\n\n      setLoading(true);\n\n      const response = await axios.get(`${API_URL}/notifications/my-notifications`, { // ✅ Fix: ruta correcta\n        headers: { Authorization: `Bearer ${token}` }\n      });\n\n      const notifs = Array.isArray(response.data) ? response.data : []; // ✅ Fix: el backend devuelve array directo\n      setNotifications(notifs.slice(0, 5));\n      setUnreadCount(notifs.filter(n => !n.read).length);\n    } catch (error) {\n      if (error.response?.status === 401) {\n        console.log('⚠️ Token inválido o expirado');\n      } else {\n        console.error('Error al cargar notificaciones:', error);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const markAsRead = async (notificationId) => {\n    try {\n      const token = sessionStorage.getItem('token');\n      await axios.put(\n        `${API_URL}/notifications/${notificationId}/read`,\n        {},\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n      setNotifications(prev =>\n        prev.map(n => (n._id === notificationId ? { ...n, read: true } : n))\n      );\n      setUnreadCount(prev => Math.max(0, prev - 1));\n    } catch (error) {\n      console.error('Error al marcar como leída:', error);\n    }\n  };\n\n  const handleNotificationClick = (notification) => {\n    if (!notification.read) markAsRead(notification._id);\n    setShowDropdown(false);\n    if (notification.link) {\n      navigate(notification.link);\n    } else if (notification.type === 'order') {\n      navigate('/perfil?tab=orders');\n    }\n  };\n\n  const handleViewAll = () => {\n    setShowDropdown(false);\n    navigate('/notifications');\n  };\n\n  return (\n    <div className=\"notification-bell\" ref={dropdownRef}>\n      <button\n        className=\"bell-button\"\n        onClick={() => setShowDropdown(!showDropdown)}\n        aria-label=\"Notificaciones\"\n      >\n        <FaBell />\n        {unreadCount > 0 && (\n          <span className=\"notification-badge\">{unreadCount > 9 ? '9+' : unreadCount}</span>\n        )}\n      </button>\n\n      {showDropdown && (\n        <div className=\"notification-dropdown\">\n          <div className=\"dropdown-header\">\n            <h3>Notificaciones</h3>\n            {unreadCount > 0 && (\n              <span className=\"unread-count\">{unreadCount} sin leer</span>\n            )}\n          </div>\n\n          <div className=\"notification-list\">\n            {loading ? (\n              <div className=\"notification-loading\">Cargando...</div>\n            ) : notifications.length === 0 ? (\n              <div className=\"notification-empty\">\n                <FaBell size={32} opacity={0.3} />\n                <p>No tienes notificaciones</p>\n              </div>\n            ) : (\n              notifications.map(notif => (\n                <div\n                  key={notif._id}\n                  className={`notification-item ${notif.read ? 'read' : 'unread'}`}\n                  onClick={() => handleNotificationClick(notif)}\n                >\n                  <div className=\"notif-content\">\n                    <strong>{notif.title}</strong>\n                    <p>{notif.message}</p>\n                    <small>\n                      {new Date(notif.createdAt).toLocaleString('es-ES', {\n                        month: 'short', day: 'numeric',\n                        hour: '2-digit', minute: '2-digit'\n                      })}\n                    </small>\n                  </div>\n                  {!notif.read && <div className=\"unread-dot\"></div>}\n                </div>\n              ))\n            )}\n          </div>\n\n          {notifications.length > 0 && (\n            <div className=\"dropdown-footer\">\n              <button onClick={handleViewAll} className=\"view-all-btn\">\n                Ver todas las notificaciones\n              </button>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default NotificationBell;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}