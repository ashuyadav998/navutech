{"ast":null,"code":"import _objectSpread from\"C:/Users/ashu_/Documents/ecommerce-sim/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useState,useContext,useEffect,useRef}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const timerRef=useRef(null);// Referencia para el temporizador de inactividad\n// --- FUNCIÓN LOGOUT ---\nconst logout=()=>{sessionStorage.clear();// Limpia token de sesión\nlocalStorage.clear();// Limpia datos de usuario\nsetUser(null);if(timerRef.current)clearTimeout(timerRef.current);};// --- LÓGICA DE INACTIVIDAD (15 MINUTOS) ---\nconst resetTimer=()=>{if(timerRef.current)clearTimeout(timerRef.current);// Solo activamos el temporizador si hay un usuario logueado\nif(user){timerRef.current=setTimeout(()=>{console.log(\"Sesión cerrada por inactividad\");logout();},900000);// 900,000ms = 15 minutos\n}};useEffect(()=>{// Si hay usuario, escuchamos eventos para resetear el timer\nif(user){const events=['mousedown','mousemove','keypress','scroll','touchstart'];resetTimer();// Iniciar al montar/loguear\nevents.forEach(event=>window.addEventListener(event,resetTimer));return()=>{if(timerRef.current)clearTimeout(timerRef.current);events.forEach(event=>window.removeEventListener(event,resetTimer));};}},[user]);// --- PERSISTENCIA AL CARGAR ---\nuseEffect(()=>{const savedUser=localStorage.getItem('user');const token=sessionStorage.getItem('token');// Si hay usuario en local pero NO hay token en session, significa que cerró el navegador\nif(savedUser&&token){setUser(JSON.parse(savedUser));}else{// Si falta el token, aseguramos limpieza\nlogout();}setLoading(false);},[]);// --- FUNCIONES DE AUTH ---\nconst login=async(email,password)=>{const res=await fetch('http://localhost:5000/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});const data=await res.json();if(res.ok){// Guardamos el USER en local para persistir nombre/avatar\nlocalStorage.setItem('user',JSON.stringify(data.user));// Guardamos el TOKEN en session para que muera al cerrar la pestaña\nsessionStorage.setItem('token',data.token);setUser(data.user);}return _objectSpread({success:res.ok},data);};const sendPasswordResetCode=async email=>{const res=await fetch('http://localhost:5000/api/auth/forgot-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});return await res.json();};const resetPassword=async(email,code,newPassword)=>{const res=await fetch('http://localhost:5000/api/auth/reset-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,code,newPassword})});return await res.json();};const isAuthenticated=()=>!!user;return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,loading,login,logout,sendPasswordResetCode,resetPassword,isAuthenticated},children:!loading&&children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","useRef","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","timerRef","logout","sessionStorage","clear","localStorage","current","clearTimeout","resetTimer","setTimeout","console","log","events","forEach","event","window","addEventListener","removeEventListener","savedUser","getItem","token","JSON","parse","login","email","password","res","fetch","method","headers","body","stringify","data","json","ok","setItem","_objectSpread","success","sendPasswordResetCode","resetPassword","code","newPassword","isAuthenticated","Provider","value","useAuth"],"sources":["C:/Users/ashu_/Documents/ecommerce-sim/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect, useRef } from 'react';\n\nconst AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const timerRef = useRef(null); // Referencia para el temporizador de inactividad\n\n  // --- FUNCIÓN LOGOUT ---\n  const logout = () => {\n    sessionStorage.clear(); // Limpia token de sesión\n    localStorage.clear();   // Limpia datos de usuario\n    setUser(null);\n    if (timerRef.current) clearTimeout(timerRef.current);\n  };\n\n  // --- LÓGICA DE INACTIVIDAD (15 MINUTOS) ---\n  const resetTimer = () => {\n    if (timerRef.current) clearTimeout(timerRef.current);\n    \n    // Solo activamos el temporizador si hay un usuario logueado\n    if (user) {\n      timerRef.current = setTimeout(() => {\n        console.log(\"Sesión cerrada por inactividad\");\n        logout();\n      }, 900000); // 900,000ms = 15 minutos\n    }\n  };\n\n  useEffect(() => {\n    // Si hay usuario, escuchamos eventos para resetear el timer\n    if (user) {\n      const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];\n      \n      resetTimer(); // Iniciar al montar/loguear\n      events.forEach(event => window.addEventListener(event, resetTimer));\n\n      return () => {\n        if (timerRef.current) clearTimeout(timerRef.current);\n        events.forEach(event => window.removeEventListener(event, resetTimer));\n      };\n    }\n  }, [user]);\n\n  // --- PERSISTENCIA AL CARGAR ---\n  useEffect(() => {\n    const savedUser = localStorage.getItem('user');\n    const token = sessionStorage.getItem('token');\n\n    // Si hay usuario en local pero NO hay token en session, significa que cerró el navegador\n    if (savedUser && token) {\n      setUser(JSON.parse(savedUser));\n    } else {\n      // Si falta el token, aseguramos limpieza\n      logout();\n    }\n    setLoading(false);\n  }, []);\n\n  // --- FUNCIONES DE AUTH ---\n  const login = async (email, password) => {\n    const res = await fetch('http://localhost:5000/api/auth/login', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ email, password }),\n    });\n    const data = await res.json();\n    \n    if (res.ok) {\n      // Guardamos el USER en local para persistir nombre/avatar\n      localStorage.setItem('user', JSON.stringify(data.user));\n      // Guardamos el TOKEN en session para que muera al cerrar la pestaña\n      sessionStorage.setItem('token', data.token);\n      setUser(data.user);\n    }\n    return { success: res.ok, ...data };\n  };\n\n  const sendPasswordResetCode = async (email) => {\n    const res = await fetch('http://localhost:5000/api/auth/forgot-password', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ email }),\n    });\n    return await res.json();\n  };\n\n  const resetPassword = async (email, code, newPassword) => {\n    const res = await fetch('http://localhost:5000/api/auth/reset-password', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ email, code, newPassword }),\n    });\n    return await res.json();\n  };\n\n  \n\n  const isAuthenticated = () => !!user;\n\n  \n\n  return (\n    <AuthContext.Provider value={{ \n      user, loading, login, logout, \n      sendPasswordResetCode, resetPassword, isAuthenticated \n    }}>\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n};\n\n\n\nexport const useAuth = () => useContext(AuthContext);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}