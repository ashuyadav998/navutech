{"ast":null,"code":"import _objectSpread from\"C:/Users/ashu_/Documents/ecommerce-sim/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import axios from'axios';import{FaBell,FaRegEnvelope,FaRegEnvelopeOpen}from'react-icons/fa';import'../../styles/Profile.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:5000/api';const NotificationsTab=()=>{const[notifications,setNotifications]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const loadNotifs=async()=>{try{const token=sessionStorage.getItem('token');if(!token){setError('No estás autenticado. Por favor, inicia sesión.');setLoading(false);return;}const res=await axios.get(\"\".concat(API_URL,\"/notifications/my-notifications\"),{// ✅ Fix: ruta correcta\nheaders:{Authorization:\"Bearer \".concat(token)}});const notifs=Array.isArray(res.data)?res.data:[];// ✅ Fix: array directo\nsetNotifications(notifs);}catch(err){var _err$response,_err$response2;if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401){setError('Tu sesión ha expirado. Por favor, vuelve a iniciar sesión.');}else if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===404){setNotifications([]);}else{setError('Error al cargar notificaciones. Intenta recargar la página.');}}finally{setLoading(false);}};loadNotifs();},[]);const markAsRead=async notificationId=>{try{const token=sessionStorage.getItem('token');await axios.put(\"\".concat(API_URL,\"/notifications/\").concat(notificationId,\"/read\"),{},{headers:{Authorization:\"Bearer \".concat(token)}});setNotifications(prev=>prev.map(n=>n._id===notificationId?_objectSpread(_objectSpread({},n),{},{read:true}):n));}catch(err){console.error('Error al marcar como leída:',err);}};if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"tab-loading\",children:\"Buscando nuevos mensajes...\"});if(error)return/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(FaBell,{size:40}),/*#__PURE__*/_jsx(\"h3\",{children:\"Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error})]});return/*#__PURE__*/_jsxs(\"div\",{className:\"notifications-tab\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tab-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Notificaciones\"}),notifications.length>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"notif-count\",children:[notifications.filter(n=>!n.read).length,\" sin leer\"]})]}),notifications.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(FaBell,{size:40}),/*#__PURE__*/_jsx(\"p\",{children:\"No tienes mensajes nuevos por ahora.\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"notif-list\",children:notifications.map(n=>/*#__PURE__*/_jsxs(\"div\",{className:\"notif-card \".concat(n.read?'read':'unread'),onClick:()=>!n.read&&markAsRead(n._id),style:{cursor:!n.read?'pointer':'default'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"notif-icon\",children:n.read?/*#__PURE__*/_jsx(FaRegEnvelopeOpen,{}):/*#__PURE__*/_jsx(FaRegEnvelope,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"notif-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:n.title}),/*#__PURE__*/_jsx(\"p\",{children:n.message}),/*#__PURE__*/_jsx(\"small\",{children:new Date(n.createdAt).toLocaleString('es-ES',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})})]})]},n._id))})]});};export default NotificationsTab;","map":{"version":3,"names":["React","useState","useEffect","axios","FaBell","FaRegEnvelope","FaRegEnvelopeOpen","jsx","_jsx","jsxs","_jsxs","API_URL","process","env","REACT_APP_API_URL","NotificationsTab","notifications","setNotifications","loading","setLoading","error","setError","loadNotifs","token","sessionStorage","getItem","res","get","concat","headers","Authorization","notifs","Array","isArray","data","err","_err$response","_err$response2","response","status","markAsRead","notificationId","put","prev","map","n","_id","_objectSpread","read","console","className","children","size","length","filter","onClick","style","cursor","title","message","Date","createdAt","toLocaleString","year","month","day","hour","minute"],"sources":["C:/Users/ashu_/Documents/ecommerce-sim/frontend/src/components/profile/NotificationsTab.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { FaBell, FaRegEnvelope, FaRegEnvelopeOpen } from 'react-icons/fa';\r\nimport '../../styles/Profile.css';\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\r\n\r\nconst NotificationsTab = () => {\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const loadNotifs = async () => {\r\n      try {\r\n        const token = sessionStorage.getItem('token');\r\n        if (!token) {\r\n          setError('No estás autenticado. Por favor, inicia sesión.');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        const res = await axios.get(`${API_URL}/notifications/my-notifications`, { // ✅ Fix: ruta correcta\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n\r\n        const notifs = Array.isArray(res.data) ? res.data : []; // ✅ Fix: array directo\r\n        setNotifications(notifs);\r\n      } catch (err) {\r\n        if (err.response?.status === 401) {\r\n          setError('Tu sesión ha expirado. Por favor, vuelve a iniciar sesión.');\r\n        } else if (err.response?.status === 404) {\r\n          setNotifications([]);\r\n        } else {\r\n          setError('Error al cargar notificaciones. Intenta recargar la página.');\r\n        }\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    loadNotifs();\r\n  }, []);\r\n\r\n  const markAsRead = async (notificationId) => {\r\n    try {\r\n      const token = sessionStorage.getItem('token');\r\n      await axios.put(\r\n        `${API_URL}/notifications/${notificationId}/read`,\r\n        {},\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n      setNotifications(prev =>\r\n        prev.map(n => n._id === notificationId ? { ...n, read: true } : n)\r\n      );\r\n    } catch (err) {\r\n      console.error('Error al marcar como leída:', err);\r\n    }\r\n  };\r\n\r\n  if (loading) return <div className=\"tab-loading\">Buscando nuevos mensajes...</div>;\r\n\r\n  if (error) return (\r\n    <div className=\"empty-state\">\r\n      <FaBell size={40} />\r\n      <h3>Error</h3>\r\n      <p>{error}</p>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"notifications-tab\">\r\n      <div className=\"tab-header\">\r\n        <h2>Notificaciones</h2>\r\n        {notifications.length > 0 && (\r\n          <span className=\"notif-count\">\r\n            {notifications.filter(n => !n.read).length} sin leer\r\n          </span>\r\n        )}\r\n      </div>\r\n\r\n      {notifications.length === 0 ? (\r\n        <div className=\"empty-state\">\r\n          <FaBell size={40} />\r\n          <p>No tienes mensajes nuevos por ahora.</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"notif-list\">\r\n          {notifications.map(n => (\r\n            <div\r\n              key={n._id}\r\n              className={`notif-card ${n.read ? 'read' : 'unread'}`}\r\n              onClick={() => !n.read && markAsRead(n._id)}\r\n              style={{ cursor: !n.read ? 'pointer' : 'default' }}\r\n            >\r\n              <div className=\"notif-icon\">\r\n                {n.read ? <FaRegEnvelopeOpen /> : <FaRegEnvelope />}\r\n              </div>\r\n              <div className=\"notif-info\">\r\n                <h4>{n.title}</h4>\r\n                <p>{n.message}</p>\r\n                <small>{new Date(n.createdAt).toLocaleString('es-ES', {\r\n                  year: 'numeric', month: 'short', day: 'numeric',\r\n                  hour: '2-digit', minute: '2-digit'\r\n                })}</small>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotificationsTab;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}