{"ast":null,"code":"import _objectSpread from\"C:/Users/ashu_/Documents/ecommerce-sim/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import axios from'axios';import{FaEdit}from'react-icons/fa';import'../../styles/Profile.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:5000/api';const ProfileTab=_ref=>{let{user,login}=_ref;const[editing,setEditing]=useState(false);const[formData,setFormData]=useState({name:'',email:'',phone:'',street:'',city:'',postalCode:'',country:'España'});// 1. CORRECCIÓN CRÍTICA: Sincronizar cuando 'user' deje de ser null/undefined\nuseEffect(()=>{if(user){var _user$address,_user$address2,_user$address3,_user$address4;setFormData({name:user.name||'',email:user.email||'',phone:user.phone||'',street:((_user$address=user.address)===null||_user$address===void 0?void 0:_user$address.street)||'',city:((_user$address2=user.address)===null||_user$address2===void 0?void 0:_user$address2.city)||'',postalCode:((_user$address3=user.address)===null||_user$address3===void 0?void 0:_user$address3.postalCode)||'',country:((_user$address4=user.address)===null||_user$address4===void 0?void 0:_user$address4.country)||'España'});}},[user]);// Este trigger es vital\nconst handleSave=async()=>{try{const token=localStorage.getItem('token');const response=await axios.put(\"\".concat(API_URL,\"/auth/profile\"),{name:formData.name,phone:formData.phone,address:{street:formData.street,city:formData.city,postalCode:formData.postalCode,country:formData.country}},{headers:{Authorization:\"Bearer \".concat(token)}});login(_objectSpread(_objectSpread({},user),response.data),token);setEditing(false);alert('Perfil actualizado correctamente');}catch(err){alert('Error al guardar los cambios');}};// 2. CORRECCIÓN: Si el usuario aún no existe, mostramos un cargando\nif(!user)return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Cargando datos de usuario...\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"profile-tab\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tab-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Mis Datos\"}),!editing?/*#__PURE__*/_jsxs(\"button\",{className:\"btn-edit\",onClick:()=>setEditing(true),children:[/*#__PURE__*/_jsx(FaEdit,{}),\" Editar Perfil\"]}):/*#__PURE__*/_jsxs(\"div\",{className:\"edit-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-save\",onClick:handleSave,children:\"Guardar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-cancel\",onClick:()=>setEditing(false),children:\"Cancelar\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-form\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Correo Electr\\xF3nico\"}),/*#__PURE__*/_jsx(\"input\",{name:\"email\",value:formData.email,disabled:true,className:\"input-readonly\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Nombre Completo\"}),/*#__PURE__*/_jsx(\"input\",{name:\"name\",value:formData.name,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{name:e.target.value})),disabled:!editing})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Tel\\xE9fono\"}),/*#__PURE__*/_jsx(\"input\",{name:\"phone\",value:formData.phone,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{phone:e.target.value})),disabled:!editing})]})]})})]});};export default ProfileTab;","map":{"version":3,"names":["React","useState","useEffect","axios","FaEdit","jsx","_jsx","jsxs","_jsxs","API_URL","process","env","REACT_APP_API_URL","ProfileTab","_ref","user","login","editing","setEditing","formData","setFormData","name","email","phone","street","city","postalCode","country","_user$address","_user$address2","_user$address3","_user$address4","address","handleSave","token","localStorage","getItem","response","put","concat","headers","Authorization","_objectSpread","data","alert","err","className","children","onClick","value","disabled","onChange","e","target"],"sources":["C:/Users/ashu_/Documents/ecommerce-sim/frontend/src/components/profile/ProfileTab.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { FaEdit } from 'react-icons/fa';\r\nimport '../../styles/Profile.css';\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\r\n\r\nconst ProfileTab = ({ user, login }) => {\r\n  const [editing, setEditing] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    street: '',\r\n    city: '',\r\n    postalCode: '',\r\n    country: 'España'\r\n  });\r\n\r\n  // 1. CORRECCIÓN CRÍTICA: Sincronizar cuando 'user' deje de ser null/undefined\r\n  useEffect(() => {\r\n    if (user) {\r\n      setFormData({\r\n        name: user.name || '',\r\n        email: user.email || '',\r\n        phone: user.phone || '',\r\n        street: user.address?.street || '',\r\n        city: user.address?.city || '',\r\n        postalCode: user.address?.postalCode || '',\r\n        country: user.address?.country || 'España'\r\n      });\r\n    }\r\n  }, [user]); // Este trigger es vital\r\n\r\n  const handleSave = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const response = await axios.put(`${API_URL}/auth/profile`, {\r\n        name: formData.name, \r\n        phone: formData.phone,\r\n        address: { \r\n          street: formData.street, \r\n          city: formData.city, \r\n          postalCode: formData.postalCode, \r\n          country: formData.country \r\n        }\r\n      }, { headers: { Authorization: `Bearer ${token}` } });\r\n      \r\n      login({ ...user, ...response.data }, token);\r\n      setEditing(false);\r\n      alert('Perfil actualizado correctamente');\r\n    } catch (err) { \r\n      alert('Error al guardar los cambios'); \r\n    }\r\n  };\r\n\r\n  // 2. CORRECCIÓN: Si el usuario aún no existe, mostramos un cargando\r\n  if (!user) return <div className=\"loading\">Cargando datos de usuario...</div>;\r\n\r\n  return (\r\n    <div className=\"profile-tab\">\r\n      <div className=\"tab-header\">\r\n        <h2>Mis Datos</h2>\r\n        {!editing ? (\r\n          <button className=\"btn-edit\" onClick={() => setEditing(true)}>\r\n            <FaEdit /> Editar Perfil\r\n          </button>\r\n        ) : (\r\n          <div className=\"edit-actions\">\r\n            <button className=\"btn-save\" onClick={handleSave}>Guardar</button>\r\n            <button className=\"btn-cancel\" onClick={() => setEditing(false)}>Cancelar</button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"profile-form\">\r\n        <div className=\"form-grid\">\r\n          <div className=\"form-group\">\r\n            <label>Correo Electrónico</label>\r\n            <input \r\n              name=\"email\" \r\n              value={formData.email} \r\n              disabled \r\n              className=\"input-readonly\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label>Nombre Completo</label>\r\n            <input \r\n              name=\"name\" \r\n              value={formData.name} \r\n              onChange={e => setFormData({...formData, name: e.target.value})} \r\n              disabled={!editing} \r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label>Teléfono</label>\r\n            <input \r\n              name=\"phone\" \r\n              value={formData.phone} \r\n              onChange={e => setFormData({...formData, phone: e.target.value})} \r\n              disabled={!editing} \r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfileTab;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}