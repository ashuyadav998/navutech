{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{io}from'socket.io-client';import{FaComments,FaTimes,FaPaperPlane,FaHeadset,FaCheckCircle,FaRedo}from'react-icons/fa';import{useAuth}from'../context/AuthContext';import axios from'axios';import'../styles/ChatWidget.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:5000/api';const SOCKET_URL=API_URL.replace('/api','');let socket=null;const ChatWidget=()=>{const{isAuthenticated}=useAuth();const[isOpen,setIsOpen]=useState(false);const[messages,setMessages]=useState([]);const[inputMessage,setInputMessage]=useState('');const[loading,setLoading]=useState(false);const[unreadCount,setUnreadCount]=useState(0);const[connected,setConnected]=useState(false);const[chatStatus,setChatStatus]=useState('open');const messagesEndRef=useRef(null);useEffect(()=>{if(!isAuthenticated())return;initializeSocket();return()=>{// No desconectar socket para mantener conexi√≥n\n};},[isAuthenticated]);useEffect(()=>{scrollToBottom();},[messages]);const initializeSocket=()=>{if(socket)return;socket=io(SOCKET_URL,{transports:['websocket','polling'],reconnection:true,reconnectionAttempts:5,reconnectionDelay:1000});socket.on('connect',()=>{console.log('‚úÖ Socket conectado');setConnected(true);const token=localStorage.getItem('token');if(token){socket.emit('authenticate',token);}});socket.on('disconnect',()=>{console.log('‚ùå Socket desconectado');setConnected(false);});socket.on('authenticated',()=>{console.log('‚úÖ Autenticado');loadChat();});socket.on('new_admin_message',chat=>{console.log('üì® Nuevo mensaje del admin');setMessages(chat.messages);setChatStatus(chat.status);const unread=chat.messages.filter(m=>m.sender==='admin'&&!m.read).length;setUnreadCount(unread);});socket.on('chat_updated',chat=>{setMessages(chat.messages);setChatStatus(chat.status);});socket.on('chat_closed',chat=>{setMessages(chat.messages);setChatStatus('closed');});socket.on('message_sent',data=>{if(data.success&&data.chat){setMessages(data.chat.messages);setChatStatus(data.chat.status);}setLoading(false);});socket.on('message_error',data=>{console.error('Error:',data.message);alert('Error al enviar mensaje');setLoading(false);});};const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};const loadChat=async()=>{try{const token=localStorage.getItem('token');if(!token)return;const response=await axios.get(\"\".concat(API_URL,\"/chat/my-chat\"),{headers:{Authorization:\"Bearer \".concat(token)}});setMessages(response.data.messages);setChatStatus(response.data.status);const unread=response.data.messages.filter(m=>m.sender==='admin'&&!m.read).length;setUnreadCount(unread);}catch(error){console.error('Error al cargar chat:',error);}};const sendMessage=e=>{e.preventDefault();if(!inputMessage.trim()||loading||!connected||chatStatus==='closed')return;setLoading(true);socket.emit('user_send_message',{text:inputMessage});setInputMessage('');};const closeChat=async()=>{if(!window.confirm('¬øEst√°s seguro de que quieres finalizar el chat?')){return;}try{const token=localStorage.getItem('token');const response=await axios.put(\"\".concat(API_URL,\"/chat/close-my-chat\"),{},{headers:{Authorization:\"Bearer \".concat(token)}});// Actualizar estado local\nsetMessages(response.data.chat.messages);setChatStatus('closed');console.log('‚úÖ Chat finalizado correctamente');}catch(error){console.error('Error al cerrar chat:',error);alert('Error al cerrar chat');}};// ‚úÖ FUNCI√ìN CORREGIDA: Iniciar nuevo chat\nconst startNewChat=async()=>{try{setLoading(true);const token=localStorage.getItem('token');console.log('üîÑ Iniciando nuevo chat...');// Llamar a la ruta para crear nuevo chat\nconst response=await axios.post(\"\".concat(API_URL,\"/chat/start-new-chat\"),{},{headers:{Authorization:\"Bearer \".concat(token)}});console.log('‚úÖ Nuevo chat creado:',response.data);// Actualizar estado con el nuevo chat\nsetMessages(response.data.messages);setChatStatus(response.data.status);setUnreadCount(0);// ‚úÖ Reconectar socket para cargar el nuevo chat\nif(socket&&socket.connected){socket.emit('authenticate',token);}}catch(error){var _error$response,_error$response$data,_error$response2,_error$response2$data;console.error('‚ùå Error al iniciar nuevo chat:',error);// Mostrar error espec√≠fico\nconst errorMsg=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Error al iniciar nuevo chat';alert(errorMsg);}finally{setLoading(false);}};const toggleChat=()=>{if(!isAuthenticated()){alert('Debes iniciar sesi√≥n para usar el chat de soporte');return;}setIsOpen(!isOpen);if(!isOpen&&unreadCount>0){setUnreadCount(0);const token=localStorage.getItem('token');axios.put(\"\".concat(API_URL,\"/chat/mark-read\"),{},{headers:{Authorization:\"Bearer \".concat(token)}}).catch(err=>console.error(err));}};const formatTime=date=>{return new Date(date).toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit'});};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-widget\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"chat-button\",onClick:toggleChat,\"aria-label\":\"Chat de soporte\",children:[isOpen?/*#__PURE__*/_jsx(FaTimes,{}):/*#__PURE__*/_jsx(FaComments,{}),!isOpen&&unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{className:\"chat-badge\",children:unreadCount})]}),isOpen&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-window\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header-info\",children:[/*#__PURE__*/_jsx(FaHeadset,{size:24}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCAC Atenci\\xF3n al Cliente\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"status-indicator\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"status-dot \".concat(connected?'online':'offline')}),connected?'En l√≠nea':'Desconectado']})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header-actions\",children:[chatStatus==='open'&&/*#__PURE__*/_jsxs(\"button\",{className:\"btn-close-conversation\",onClick:closeChat,title:\"Finalizar conversaci\\xF3n\",children:[/*#__PURE__*/_jsx(FaCheckCircle,{}),\" Finalizar\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleChat,\"aria-label\":\"Cerrar chat\",children:/*#__PURE__*/_jsx(FaTimes,{})})]})]}),chatStatus==='closed'&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-closed-notice\",children:[/*#__PURE__*/_jsx(FaCheckCircle,{size:48,color:\"#4ade80\"}),/*#__PURE__*/_jsx(\"h4\",{children:\"Conversaci\\xF3n finalizada\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Esta conversaci\\xF3n ha sido cerrada.\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn-new-chat\",onClick:startNewChat,disabled:loading,children:[/*#__PURE__*/_jsx(FaRedo,{}),\" \",loading?'Iniciando...':'Iniciar nueva conversaci√≥n']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",children:[messages.length===0&&chatStatus==='open'&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-empty-state\",children:[/*#__PURE__*/_jsx(FaHeadset,{size:48,color:\"#cbd5e1\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\xA1Hola! \\xBFEn qu\\xE9 podemos ayudarte?\"})]}),messages.map((message,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"message \".concat(message.sender==='user'?'user-message':'admin-message'),children:[message.sender==='admin'&&/*#__PURE__*/_jsx(\"div\",{className:\"message-avatar\",children:/*#__PURE__*/_jsx(FaHeadset,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-content\",children:[message.sender==='admin'&&/*#__PURE__*/_jsx(\"span\",{className:\"message-sender\",children:\"Soporte SimShop\"}),/*#__PURE__*/_jsx(\"p\",{children:message.text}),/*#__PURE__*/_jsx(\"span\",{className:\"message-time\",children:formatTime(message.timestamp)})]})]},index)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),chatStatus==='open'?/*#__PURE__*/_jsxs(\"form\",{onSubmit:sendMessage,className:\"chat-input-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:inputMessage,onChange:e=>setInputMessage(e.target.value),placeholder:\"Escribe tu mensaje...\",disabled:loading||!connected}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading||!inputMessage.trim()||!connected,children:/*#__PURE__*/_jsx(FaPaperPlane,{})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"chat-input-disabled\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\uD83D\\uDCAC Chat finalizado - Puedes iniciar uno nuevo arriba\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-footer\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"\\uD83D\\uDD12 \",connected?'Conectado y seguro':'Reconectando...']})})]})]});};export default ChatWidget;","map":{"version":3,"names":["React","useState","useEffect","useRef","io","FaComments","FaTimes","FaPaperPlane","FaHeadset","FaCheckCircle","FaRedo","useAuth","axios","jsx","_jsx","jsxs","_jsxs","API_URL","process","env","REACT_APP_API_URL","SOCKET_URL","replace","socket","ChatWidget","isAuthenticated","isOpen","setIsOpen","messages","setMessages","inputMessage","setInputMessage","loading","setLoading","unreadCount","setUnreadCount","connected","setConnected","chatStatus","setChatStatus","messagesEndRef","initializeSocket","scrollToBottom","transports","reconnection","reconnectionAttempts","reconnectionDelay","on","console","log","token","localStorage","getItem","emit","loadChat","chat","status","unread","filter","m","sender","read","length","data","success","error","message","alert","_messagesEndRef$curre","current","scrollIntoView","behavior","response","get","concat","headers","Authorization","sendMessage","e","preventDefault","trim","text","closeChat","window","confirm","put","startNewChat","post","_error$response","_error$response$data","_error$response2","_error$response2$data","errorMsg","toggleChat","catch","err","formatTime","date","Date","toLocaleTimeString","hour","minute","className","children","onClick","size","title","color","disabled","map","index","timestamp","ref","onSubmit","type","value","onChange","target","placeholder"],"sources":["C:/Users/ashu_/Documents/ecommerce-sim/frontend/src/components/ChatWidget.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { io } from 'socket.io-client';\nimport { FaComments, FaTimes, FaPaperPlane, FaHeadset, FaCheckCircle, FaRedo } from 'react-icons/fa';\nimport { useAuth } from '../context/AuthContext';\nimport axios from 'axios';\nimport '../styles/ChatWidget.css';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\nconst SOCKET_URL = API_URL.replace('/api', '');\n\nlet socket = null;\n\nconst ChatWidget = () => {\n  const { isAuthenticated } = useAuth();\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [connected, setConnected] = useState(false);\n  const [chatStatus, setChatStatus] = useState('open');\n  const messagesEndRef = useRef(null);\n\n  useEffect(() => {\n    if (!isAuthenticated()) return;\n\n    initializeSocket();\n\n    return () => {\n      // No desconectar socket para mantener conexi√≥n\n    };\n  }, [isAuthenticated]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const initializeSocket = () => {\n    if (socket) return;\n\n    socket = io(SOCKET_URL, {\n      transports: ['websocket', 'polling'],\n      reconnection: true,\n      reconnectionAttempts: 5,\n      reconnectionDelay: 1000\n    });\n\n    socket.on('connect', () => {\n      console.log('‚úÖ Socket conectado');\n      setConnected(true);\n      \n      const token = localStorage.getItem('token');\n      if (token) {\n        socket.emit('authenticate', token);\n      }\n    });\n\n    socket.on('disconnect', () => {\n      console.log('‚ùå Socket desconectado');\n      setConnected(false);\n    });\n\n    socket.on('authenticated', () => {\n      console.log('‚úÖ Autenticado');\n      loadChat();\n    });\n\n    socket.on('new_admin_message', (chat) => {\n      console.log('üì® Nuevo mensaje del admin');\n      setMessages(chat.messages);\n      setChatStatus(chat.status);\n      \n      const unread = chat.messages.filter(m => m.sender === 'admin' && !m.read).length;\n      setUnreadCount(unread);\n    });\n\n    socket.on('chat_updated', (chat) => {\n      setMessages(chat.messages);\n      setChatStatus(chat.status);\n    });\n\n    socket.on('chat_closed', (chat) => {\n      setMessages(chat.messages);\n      setChatStatus('closed');\n    });\n\n    socket.on('message_sent', (data) => {\n      if (data.success && data.chat) {\n        setMessages(data.chat.messages);\n        setChatStatus(data.chat.status);\n      }\n      setLoading(false);\n    });\n\n    socket.on('message_error', (data) => {\n      console.error('Error:', data.message);\n      alert('Error al enviar mensaje');\n      setLoading(false);\n    });\n  };\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const loadChat = async () => {\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) return;\n\n      const response = await axios.get(`${API_URL}/chat/my-chat`, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n\n      setMessages(response.data.messages);\n      setChatStatus(response.data.status);\n      \n      const unread = response.data.messages.filter(\n        m => m.sender === 'admin' && !m.read\n      ).length;\n      setUnreadCount(unread);\n\n    } catch (error) {\n      console.error('Error al cargar chat:', error);\n    }\n  };\n\n  const sendMessage = (e) => {\n    e.preventDefault();\n    if (!inputMessage.trim() || loading || !connected || chatStatus === 'closed') return;\n\n    setLoading(true);\n    socket.emit('user_send_message', { text: inputMessage });\n    setInputMessage('');\n  };\n\n  const closeChat = async () => {\n    if (!window.confirm('¬øEst√°s seguro de que quieres finalizar el chat?')) {\n      return;\n    }\n\n    try {\n      const token = localStorage.getItem('token');\n      \n      const response = await axios.put(\n        `${API_URL}/chat/close-my-chat`,\n        {},\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n\n      // Actualizar estado local\n      setMessages(response.data.chat.messages);\n      setChatStatus('closed');\n      \n      console.log('‚úÖ Chat finalizado correctamente');\n      \n    } catch (error) {\n      console.error('Error al cerrar chat:', error);\n      alert('Error al cerrar chat');\n    }\n  };\n\n  // ‚úÖ FUNCI√ìN CORREGIDA: Iniciar nuevo chat\n  const startNewChat = async () => {\n    try {\n      setLoading(true);\n      const token = localStorage.getItem('token');\n\n      console.log('üîÑ Iniciando nuevo chat...');\n\n      // Llamar a la ruta para crear nuevo chat\n      const response = await axios.post(\n        `${API_URL}/chat/start-new-chat`,\n        {},\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n\n      console.log('‚úÖ Nuevo chat creado:', response.data);\n\n      // Actualizar estado con el nuevo chat\n      setMessages(response.data.messages);\n      setChatStatus(response.data.status);\n      setUnreadCount(0);\n      \n      // ‚úÖ Reconectar socket para cargar el nuevo chat\n      if (socket && socket.connected) {\n        socket.emit('authenticate', token);\n      }\n      \n    } catch (error) {\n      console.error('‚ùå Error al iniciar nuevo chat:', error);\n      \n      // Mostrar error espec√≠fico\n      const errorMsg = error.response?.data?.message || \n                      error.response?.data?.error || \n                      'Error al iniciar nuevo chat';\n      \n      alert(errorMsg);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const toggleChat = () => {\n    if (!isAuthenticated()) {\n      alert('Debes iniciar sesi√≥n para usar el chat de soporte');\n      return;\n    }\n    setIsOpen(!isOpen);\n\n    if (!isOpen && unreadCount > 0) {\n      setUnreadCount(0);\n      const token = localStorage.getItem('token');\n      axios.put(`${API_URL}/chat/mark-read`, {}, {\n        headers: { Authorization: `Bearer ${token}` }\n      }).catch(err => console.error(err));\n    }\n  };\n\n  const formatTime = (date) => {\n    return new Date(date).toLocaleTimeString('es-ES', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  return (\n    <div className=\"chat-widget\">\n      <button \n        className=\"chat-button\" \n        onClick={toggleChat}\n        aria-label=\"Chat de soporte\"\n      >\n        {isOpen ? <FaTimes /> : <FaComments />}\n        {!isOpen && unreadCount > 0 && (\n          <span className=\"chat-badge\">{unreadCount}</span>\n        )}\n      </button>\n\n      {isOpen && (\n        <div className=\"chat-window\">\n          <div className=\"chat-header\">\n            <div className=\"chat-header-info\">\n              <FaHeadset size={24} />\n              <div>\n                <h3>üí¨ Atenci√≥n al Cliente</h3>\n                <p className=\"status-indicator\">\n                  <span className={`status-dot ${connected ? 'online' : 'offline'}`}></span>\n                  {connected ? 'En l√≠nea' : 'Desconectado'}\n                </p>\n              </div>\n            </div>\n            <div className=\"chat-header-actions\">\n              {chatStatus === 'open' && (\n                <button \n                  className=\"btn-close-conversation\" \n                  onClick={closeChat}\n                  title=\"Finalizar conversaci√≥n\"\n                >\n                  <FaCheckCircle /> Finalizar\n                </button>\n              )}\n              <button onClick={toggleChat} aria-label=\"Cerrar chat\">\n                <FaTimes />\n              </button>\n            </div>\n          </div>\n\n          {/* ‚úÖ AVISO CUANDO EL CHAT EST√Å CERRADO */}\n          {chatStatus === 'closed' && (\n            <div className=\"chat-closed-notice\">\n              <FaCheckCircle size={48} color=\"#4ade80\" />\n              <h4>Conversaci√≥n finalizada</h4>\n              <p>Esta conversaci√≥n ha sido cerrada.</p>\n              <button \n                className=\"btn-new-chat\"\n                onClick={startNewChat}\n                disabled={loading}\n              >\n                <FaRedo /> {loading ? 'Iniciando...' : 'Iniciar nueva conversaci√≥n'}\n              </button>\n            </div>\n          )}\n\n          {/* MENSAJES */}\n          <div className=\"chat-messages\">\n            {messages.length === 0 && chatStatus === 'open' && (\n              <div className=\"chat-empty-state\">\n                <FaHeadset size={48} color=\"#cbd5e1\" />\n                <p>¬°Hola! ¬øEn qu√© podemos ayudarte?</p>\n              </div>\n            )}\n            \n            {messages.map((message, index) => (\n              <div\n                key={index}\n                className={`message ${message.sender === 'user' ? 'user-message' : 'admin-message'}`}\n              >\n                {message.sender === 'admin' && (\n                  <div className=\"message-avatar\">\n                    <FaHeadset />\n                  </div>\n                )}\n                <div className=\"message-content\">\n                  {message.sender === 'admin' && (\n                    <span className=\"message-sender\">Soporte SimShop</span>\n                  )}\n                  <p>{message.text}</p>\n                  <span className=\"message-time\">{formatTime(message.timestamp)}</span>\n                </div>\n              </div>\n            ))}\n            <div ref={messagesEndRef} />\n          </div>\n\n          {/* INPUT O MENSAJE DE CERRADO */}\n          {chatStatus === 'open' ? (\n            <form onSubmit={sendMessage} className=\"chat-input-form\">\n              <input\n                type=\"text\"\n                value={inputMessage}\n                onChange={(e) => setInputMessage(e.target.value)}\n                placeholder=\"Escribe tu mensaje...\"\n                disabled={loading || !connected}\n              />\n              <button type=\"submit\" disabled={loading || !inputMessage.trim() || !connected}>\n                <FaPaperPlane />\n              </button>\n            </form>\n          ) : (\n            <div className=\"chat-input-disabled\">\n              <p>üí¨ Chat finalizado - Puedes iniciar uno nuevo arriba</p>\n            </div>\n          )}\n\n          {/* FOOTER */}\n          <div className=\"chat-footer\">\n            <small>üîí {connected ? 'Conectado y seguro' : 'Reconectando...'}</small>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ChatWidget;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}