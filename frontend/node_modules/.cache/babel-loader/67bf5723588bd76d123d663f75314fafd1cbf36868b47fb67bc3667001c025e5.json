{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ashu_\\\\Documents\\\\ecommerce-sim\\\\frontend\\\\src\\\\pages\\\\admin\\\\AdminOrders.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { FaEye, FaEdit, FaPhone, FaFilePdf, FaDownload } from 'react-icons/fa';\nimport axios from 'axios';\nimport '../../styles/AdminOrders.css';\nimport { toast } from 'react-toastify';\n\n// ConfiguraciÃ³n de Axios para evitar repeticiÃ³n de cÃ³digo\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\nconst api = axios.create({\n  baseURL: API_URL\n});\n\n// Interceptor para adjuntar el token automÃ¡ticamente\napi.interceptors.request.use(config => {\n  const token = sessionStorage.getItem('token');\n  if (token) config.headers.Authorization = `Bearer ${token}`;\n  return config;\n});\nconst AdminOrders = () => {\n  _s();\n  var _selectedOrder$shippi, _selectedOrder$shippi2;\n  const [orders, setOrders] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n  const [selectedOrder, setSelectedOrder] = useState(null);\n  const [showDetailModal, setShowDetailModal] = useState(false);\n  const [statusUpdate, setStatusUpdate] = useState({\n    orderStatus: '',\n    paymentStatus: ''\n  });\n  const [error, setError] = useState(null);\n  const notifiedOrders = useRef(new Set());\n  const isFirstLoad = useRef(true);\n\n  // --- LÃ³gica de Notificaciones ---\n  const handleNewOrderNotification = useCallback(newOrders => {\n    const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');\n    audio.play().catch(() => console.log('InteracciÃ³n requerida para audio'));\n    newOrders.forEach(order => {\n      toast.info(`ðŸ”” NUEVO PEDIDO: #${order._id.slice(-6).toUpperCase()}`, {\n        autoClose: 8000\n      });\n    });\n    if (navigator.vibrate) navigator.vibrate([200, 100, 200]);\n    if (Notification.permission === \"granted\") {\n      new Notification(\"ðŸ›’ Nuevo pedido recibido\", {\n        body: `${newOrders.length} pedido(s) nuevo(s).`,\n        icon: \"/logo192.png\"\n      });\n    }\n  }, []);\n\n  // --- Carga de Datos ---\n  const loadOrders = async (initial = false) => {\n    try {\n      if (initial) setLoading(true);\n      setRefreshing(true);\n      const {\n        data\n      } = await api.get('/orders');\n      const ordersData = Array.isArray(data) ? data : [];\n\n      // Detectar nuevos pedidos para notificar\n      if (!initial && !isFirstLoad.current) {\n        const freshOrders = ordersData.filter(o => !notifiedOrders.current.has(o._id) && o.orderStatus === 'pendiente');\n        if (freshOrders.length > 0) {\n          handleNewOrderNotification(freshOrders);\n          freshOrders.forEach(o => notifiedOrders.current.add(o._id));\n        }\n      }\n      if (initial) {\n        ordersData.forEach(o => notifiedOrders.current.add(o._id));\n        isFirstLoad.current = false;\n      }\n      setOrders(ordersData);\n      setError(null);\n    } catch (err) {\n      var _err$response, _err$response$data;\n      setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || 'Error de conexiÃ³n');\n    } finally {\n      setLoading(false);\n      setRefreshing(false);\n    }\n  };\n  useEffect(() => {\n    loadOrders(true);\n    if (Notification.permission === \"default\") Notification.requestPermission();\n    const interval = setInterval(() => loadOrders(false), 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  // --- GestiÃ³n de Etiquetas (PDF) ---\n  const getLabelBlob = async trackingNumber => {\n    const response = await api.get(`/tracking/${trackingNumber}/label`, {\n      responseType: 'blob'\n    });\n    return new Blob([response.data], {\n      type: 'application/pdf'\n    });\n  };\n  const downloadLabel = async order => {\n    var _order$tracking;\n    const trackingNumber = (_order$tracking = order.tracking) === null || _order$tracking === void 0 ? void 0 : _order$tracking.trackingNumber;\n    if (!trackingNumber) return toast.error('Sin nÃºmero de tracking');\n    const loadId = toast.loading('Generando PDF...');\n    try {\n      const blob = await getLabelBlob(trackingNumber);\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `etiqueta-${trackingNumber}.pdf`;\n      link.click();\n      window.URL.revokeObjectURL(url);\n      toast.update(loadId, {\n        render: 'âœ… Descargado',\n        type: 'success',\n        isLoading: false,\n        autoClose: 2000\n      });\n    } catch (err) {\n      toast.update(loadId, {\n        render: 'âŒ Error al descargar',\n        type: 'error',\n        isLoading: false,\n        autoClose: 3000\n      });\n    }\n  };\n  const viewLabel = async order => {\n    var _order$tracking2;\n    const trackingNumber = (_order$tracking2 = order.tracking) === null || _order$tracking2 === void 0 ? void 0 : _order$tracking2.trackingNumber;\n    if (!trackingNumber) return toast.error('Sin nÃºmero de tracking');\n    try {\n      const blob = await getLabelBlob(trackingNumber);\n      const url = window.URL.createObjectURL(blob);\n      window.open(url, '_blank');\n      // Nota: No revocar inmediatamente el URL o la pestaÃ±a nueva fallarÃ¡\n    } catch (err) {\n      toast.error('No se pudo abrir la vista previa');\n    }\n  };\n\n  // --- Acciones de Estado ---\n  const updateOrderStatus = async () => {\n    try {\n      await api.put(`/orders/${selectedOrder._id}/status`, statusUpdate);\n      toast.success('Estado actualizado correctamente');\n      setShowDetailModal(false);\n      loadOrders(false);\n    } catch (err) {\n      var _err$response2, _err$response2$data;\n      toast.error(((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || 'Error al actualizar');\n    }\n  };\n  const handleCreateTracking = async orderId => {\n    try {\n      await api.post(`/tracking/create`, {\n        orderId\n      });\n      toast.success(\"Etiqueta generada\");\n      loadOrders(false);\n    } catch (err) {\n      toast.error(\"Error al generar etiqueta\");\n    }\n  };\n\n  // Helper de Formato\n  const formatPrice = p => new Intl.NumberFormat('es-ES', {\n    style: 'currency',\n    currency: 'EUR'\n  }).format(p);\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"loading-screen\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"spinner\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 55\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 158,\n    columnNumber: 23\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"admin-orders\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"page-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: [\"Gesti\\xF3n de Pedidos \", refreshing && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"refresh-mini\",\n          children: \"\\uD83D\\uDD04\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 47\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"stats-bar\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: [\"Total: \", /*#__PURE__*/_jsxDEV(\"b\", {\n            children: orders.length\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 24\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [\"Pendientes: \", /*#__PURE__*/_jsxDEV(\"b\", {\n            children: orders.filter(o => o.orderStatus === 'pendiente').length\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn-refresh\",\n        onClick: () => loadOrders(true),\n        children: \"Actualizar Lista\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"table-container\",\n      children: /*#__PURE__*/_jsxDEV(\"table\", {\n        className: \"admin-table\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"ID\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Cliente\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 176,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Total\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Estado\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 178,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Etiqueta\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Acciones\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: orders.map(order => {\n            var _order$user;\n            return /*#__PURE__*/_jsxDEV(\"tr\", {\n              className: order.orderStatus === 'pendiente' ? 'row-urgent' : '',\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: [\"#\", order._id.slice(-6).toUpperCase()]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 186,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"cell-user\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    children: (_order$user = order.user) === null || _order$user === void 0 ? void 0 : _order$user.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 189,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                    children: [/*#__PURE__*/_jsxDEV(FaPhone, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 190,\n                      columnNumber: 28\n                    }, this), \" \", order.phone || 'N/A']\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 190,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 188,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 187,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: formatPrice(order.totalAmount)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 193,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: `badge badge-${order.orderStatus}`,\n                  children: order.orderStatus\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 195,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: !order.tracking ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn-action btn-gen\",\n                  onClick: () => handleCreateTracking(order._id),\n                  children: [/*#__PURE__*/_jsxDEV(FaFilePdf, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 202,\n                    columnNumber: 23\n                  }, this), \" Generar\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 201,\n                  columnNumber: 21\n                }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"btn-group\",\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn-small\",\n                    onClick: () => downloadLabel(order),\n                    children: /*#__PURE__*/_jsxDEV(FaDownload, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 206,\n                      columnNumber: 90\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 206,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn-small btn-blue\",\n                    onClick: () => viewLabel(order),\n                    children: /*#__PURE__*/_jsxDEV(FaEye, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 207,\n                      columnNumber: 95\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 207,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 205,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 199,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn-icon\",\n                  onClick: () => {\n                    setSelectedOrder(order);\n                    setStatusUpdate({\n                      orderStatus: order.orderStatus,\n                      paymentStatus: order.paymentStatus\n                    });\n                    setShowDetailModal(true);\n                  },\n                  children: /*#__PURE__*/_jsxDEV(FaEdit, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 217,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 212,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 211,\n                columnNumber: 17\n              }, this)]\n            }, order._id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 15\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 7\n    }, this), showDetailModal && selectedOrder && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-overlay\",\n      onClick: () => setShowDetailModal(false),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-content\",\n        onClick: e => e.stopPropagation(),\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: [\"Pedido #\", selectedOrder._id.slice(-6).toUpperCase()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-body\",\n          children: [/*#__PURE__*/_jsxDEV(\"section\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: \"Direcci\\xF3n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 233,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [(_selectedOrder$shippi = selectedOrder.shippingAddress) === null || _selectedOrder$shippi === void 0 ? void 0 : _selectedOrder$shippi.street, \", \", (_selectedOrder$shippi2 = selectedOrder.shippingAddress) === null || _selectedOrder$shippi2 === void 0 ? void 0 : _selectedOrder$shippi2.city]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 234,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 232,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: \"Actualizar Estado\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 237,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              value: statusUpdate.orderStatus,\n              onChange: e => setStatusUpdate({\n                ...statusUpdate,\n                orderStatus: e.target.value\n              }),\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"pendiente\",\n                children: \"Pendiente\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 242,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"procesando\",\n                children: \"Procesando\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 243,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"enviado\",\n                children: \"Enviado\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 244,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"entregado\",\n                children: \"Entregado\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 238,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn-save\",\n              onClick: updateOrderStatus,\n              children: \"Guardar Cambios\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 161,\n    columnNumber: 5\n  }, this);\n};\n_s(AdminOrders, \"IFCYvzhPEixLvQUxvY4vxcrbAbc=\");\n_c = AdminOrders;\nexport default AdminOrders;\nvar _c;\n$RefreshReg$(_c, \"AdminOrders\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","FaEye","FaEdit","FaPhone","FaFilePdf","FaDownload","axios","toast","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","api","create","baseURL","interceptors","request","use","config","token","sessionStorage","getItem","headers","Authorization","AdminOrders","_s","_selectedOrder$shippi","_selectedOrder$shippi2","orders","setOrders","loading","setLoading","refreshing","setRefreshing","selectedOrder","setSelectedOrder","showDetailModal","setShowDetailModal","statusUpdate","setStatusUpdate","orderStatus","paymentStatus","error","setError","notifiedOrders","Set","isFirstLoad","handleNewOrderNotification","newOrders","audio","Audio","play","catch","console","log","forEach","order","info","_id","slice","toUpperCase","autoClose","navigator","vibrate","Notification","permission","body","length","icon","loadOrders","initial","data","get","ordersData","Array","isArray","current","freshOrders","filter","o","has","add","err","_err$response","_err$response$data","response","message","requestPermission","interval","setInterval","clearInterval","getLabelBlob","trackingNumber","responseType","Blob","type","downloadLabel","_order$tracking","tracking","loadId","blob","url","window","URL","createObjectURL","link","document","createElement","href","download","click","revokeObjectURL","update","render","isLoading","viewLabel","_order$tracking2","open","updateOrderStatus","put","success","_err$response2","_err$response2$data","handleCreateTracking","orderId","post","formatPrice","p","Intl","NumberFormat","style","currency","format","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","map","_order$user","user","name","phone","totalAmount","e","stopPropagation","shippingAddress","street","city","value","onChange","target","_c","$RefreshReg$"],"sources":["C:/Users/ashu_/Documents/ecommerce-sim/frontend/src/pages/admin/AdminOrders.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { FaEye, FaEdit, FaPhone, FaFilePdf, FaDownload } from 'react-icons/fa';\nimport axios from 'axios';\nimport '../../styles/AdminOrders.css';\nimport { toast } from 'react-toastify';\n\n// ConfiguraciÃ³n de Axios para evitar repeticiÃ³n de cÃ³digo\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\nconst api = axios.create({ baseURL: API_URL });\n\n// Interceptor para adjuntar el token automÃ¡ticamente\napi.interceptors.request.use(config => {\n  const token = sessionStorage.getItem('token');\n  if (token) config.headers.Authorization = `Bearer ${token}`;\n  return config;\n});\n\nconst AdminOrders = () => {\n  const [orders, setOrders] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n  const [selectedOrder, setSelectedOrder] = useState(null);\n  const [showDetailModal, setShowDetailModal] = useState(false);\n  const [statusUpdate, setStatusUpdate] = useState({ orderStatus: '', paymentStatus: '' });\n  const [error, setError] = useState(null);\n\n  const notifiedOrders = useRef(new Set());\n  const isFirstLoad = useRef(true);\n\n  // --- LÃ³gica de Notificaciones ---\n  const handleNewOrderNotification = useCallback((newOrders) => {\n    const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');\n    audio.play().catch(() => console.log('InteracciÃ³n requerida para audio'));\n\n    newOrders.forEach(order => {\n      toast.info(`ðŸ”” NUEVO PEDIDO: #${order._id.slice(-6).toUpperCase()}`, { autoClose: 8000 });\n    });\n\n    if (navigator.vibrate) navigator.vibrate([200, 100, 200]);\n\n    if (Notification.permission === \"granted\") {\n      new Notification(\"ðŸ›’ Nuevo pedido recibido\", {\n        body: `${newOrders.length} pedido(s) nuevo(s).`,\n        icon: \"/logo192.png\"\n      });\n    }\n  }, []);\n\n  // --- Carga de Datos ---\n  const loadOrders = async (initial = false) => {\n    try {\n      if (initial) setLoading(true);\n      setRefreshing(true);\n      \n      const { data } = await api.get('/orders');\n      const ordersData = Array.isArray(data) ? data : [];\n      \n      // Detectar nuevos pedidos para notificar\n      if (!initial && !isFirstLoad.current) {\n        const freshOrders = ordersData.filter(o => \n          !notifiedOrders.current.has(o._id) && o.orderStatus === 'pendiente'\n        );\n        if (freshOrders.length > 0) {\n          handleNewOrderNotification(freshOrders);\n          freshOrders.forEach(o => notifiedOrders.current.add(o._id));\n        }\n      }\n\n      if (initial) {\n        ordersData.forEach(o => notifiedOrders.current.add(o._id));\n        isFirstLoad.current = false;\n      }\n\n      setOrders(ordersData);\n      setError(null);\n    } catch (err) {\n      setError(err.response?.data?.message || 'Error de conexiÃ³n');\n    } finally {\n      setLoading(false);\n      setRefreshing(false);\n    }\n  };\n\n  useEffect(() => {\n    loadOrders(true);\n    if (Notification.permission === \"default\") Notification.requestPermission();\n    \n    const interval = setInterval(() => loadOrders(false), 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  // --- GestiÃ³n de Etiquetas (PDF) ---\n  const getLabelBlob = async (trackingNumber) => {\n    const response = await api.get(`/tracking/${trackingNumber}/label`, {\n      responseType: 'blob'\n    });\n    return new Blob([response.data], { type: 'application/pdf' });\n  };\n\n  const downloadLabel = async (order) => {\n    const trackingNumber = order.tracking?.trackingNumber;\n    if (!trackingNumber) return toast.error('Sin nÃºmero de tracking');\n\n    const loadId = toast.loading('Generando PDF...');\n    try {\n      const blob = await getLabelBlob(trackingNumber);\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `etiqueta-${trackingNumber}.pdf`;\n      link.click();\n      window.URL.revokeObjectURL(url);\n      toast.update(loadId, { render: 'âœ… Descargado', type: 'success', isLoading: false, autoClose: 2000 });\n    } catch (err) {\n      toast.update(loadId, { render: 'âŒ Error al descargar', type: 'error', isLoading: false, autoClose: 3000 });\n    }\n  };\n\n  const viewLabel = async (order) => {\n    const trackingNumber = order.tracking?.trackingNumber;\n    if (!trackingNumber) return toast.error('Sin nÃºmero de tracking');\n\n    try {\n      const blob = await getLabelBlob(trackingNumber);\n      const url = window.URL.createObjectURL(blob);\n      window.open(url, '_blank');\n      // Nota: No revocar inmediatamente el URL o la pestaÃ±a nueva fallarÃ¡\n    } catch (err) {\n      toast.error('No se pudo abrir la vista previa');\n    }\n  };\n\n  // --- Acciones de Estado ---\n  const updateOrderStatus = async () => {\n    try {\n      await api.put(`/orders/${selectedOrder._id}/status`, statusUpdate);\n      toast.success('Estado actualizado correctamente');\n      setShowDetailModal(false);\n      loadOrders(false);\n    } catch (err) {\n      toast.error(err.response?.data?.message || 'Error al actualizar');\n    }\n  };\n\n  const handleCreateTracking = async (orderId) => {\n    try {\n      await api.post(`/tracking/create`, { orderId });\n      toast.success(\"Etiqueta generada\");\n      loadOrders(false);\n    } catch (err) {\n      toast.error(\"Error al generar etiqueta\");\n    }\n  };\n\n  // Helper de Formato\n  const formatPrice = (p) => new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(p);\n\n  if (loading) return <div className=\"loading-screen\"><div className=\"spinner\"></div></div>;\n\n  return (\n    <div className=\"admin-orders\">\n      <header className=\"page-header\">\n        <h2>GestiÃ³n de Pedidos {refreshing && <span className=\"refresh-mini\">ðŸ”„</span>}</h2>\n        <div className=\"stats-bar\">\n          <span>Total: <b>{orders.length}</b></span>\n          <span>Pendientes: <b>{orders.filter(o => o.orderStatus === 'pendiente').length}</b></span>\n        </div>\n        <button className=\"btn-refresh\" onClick={() => loadOrders(true)}>Actualizar Lista</button>\n      </header>\n\n      <div className=\"table-container\">\n        <table className=\"admin-table\">\n          <thead>\n            <tr>\n              <th>ID</th>\n              <th>Cliente</th>\n              <th>Total</th>\n              <th>Estado</th>\n              <th>Etiqueta</th>\n              <th>Acciones</th>\n            </tr>\n          </thead>\n          <tbody>\n            {orders.map(order => (\n              <tr key={order._id} className={order.orderStatus === 'pendiente' ? 'row-urgent' : ''}>\n                <td>#{order._id.slice(-6).toUpperCase()}</td>\n                <td>\n                  <div className=\"cell-user\">\n                    <span>{order.user?.name}</span>\n                    <small><FaPhone /> {order.phone || 'N/A'}</small>\n                  </div>\n                </td>\n                <td>{formatPrice(order.totalAmount)}</td>\n                <td>\n                  <span className={`badge badge-${order.orderStatus}`}>\n                    {order.orderStatus}\n                  </span>\n                </td>\n                <td>\n                  {!order.tracking ? (\n                    <button className=\"btn-action btn-gen\" onClick={() => handleCreateTracking(order._id)}>\n                      <FaFilePdf /> Generar\n                    </button>\n                  ) : (\n                    <div className=\"btn-group\">\n                      <button className=\"btn-small\" onClick={() => downloadLabel(order)}><FaDownload /></button>\n                      <button className=\"btn-small btn-blue\" onClick={() => viewLabel(order)}><FaEye /></button>\n                    </div>\n                  )}\n                </td>\n                <td>\n                  <button className=\"btn-icon\" onClick={() => {\n                    setSelectedOrder(order);\n                    setStatusUpdate({ orderStatus: order.orderStatus, paymentStatus: order.paymentStatus });\n                    setShowDetailModal(true);\n                  }}>\n                    <FaEdit />\n                  </button>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n\n      {/* Modal de Detalle */}\n      {showDetailModal && selectedOrder && (\n        <div className=\"modal-overlay\" onClick={() => setShowDetailModal(false)}>\n          <div className=\"modal-content\" onClick={e => e.stopPropagation()}>\n            <h3>Pedido #{selectedOrder._id.slice(-6).toUpperCase()}</h3>\n            <div className=\"modal-body\">\n              <section>\n                <h4>DirecciÃ³n</h4>\n                <p>{selectedOrder.shippingAddress?.street}, {selectedOrder.shippingAddress?.city}</p>\n              </section>\n              <section>\n                <h4>Actualizar Estado</h4>\n                <select \n                  value={statusUpdate.orderStatus} \n                  onChange={(e) => setStatusUpdate({...statusUpdate, orderStatus: e.target.value})}\n                >\n                  <option value=\"pendiente\">Pendiente</option>\n                  <option value=\"procesando\">Procesando</option>\n                  <option value=\"enviado\">Enviado</option>\n                  <option value=\"entregado\">Entregado</option>\n                </select>\n                <button className=\"btn-save\" onClick={updateOrderStatus}>Guardar Cambios</button>\n              </section>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AdminOrders;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}