{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{io}from'socket.io-client';import{FaComments,FaTimes,FaPaperPlane,FaHeadset,FaCheckCircle,FaRedo}from'react-icons/fa';import{useAuth}from'../context/AuthContext';import axios from'axios';import'../styles/ChatWidget.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||'http://localhost:5000/api';const SOCKET_URL=API_URL.replace('/api','');let socket=null;const ChatWidget=()=>{const{isAuthenticated}=useAuth();const[isOpen,setIsOpen]=useState(false);const[messages,setMessages]=useState([]);const[inputMessage,setInputMessage]=useState('');const[loading,setLoading]=useState(false);const[unreadCount,setUnreadCount]=useState(0);const[connected,setConnected]=useState(false);const[chatStatus,setChatStatus]=useState('open');const messagesEndRef=useRef(null);const getToken=()=>{return localStorage.getItem('token')||sessionStorage.getItem('token');};useEffect(()=>{const interceptor=axios.interceptors.response.use(response=>response,error=>{var _error$response;if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){var _error$response2,_error$response2$data,_error$response3,_error$response3$data;const errorMsg=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.error)||'';if(errorMsg.toLowerCase().includes('token')||errorMsg.toLowerCase().includes('expirado')||errorMsg.toLowerCase().includes('expired')||errorMsg.toLowerCase().includes('invÃ¡lido')||errorMsg.toLowerCase().includes('invalid')){sessionStorage.removeItem('token');localStorage.removeItem('token');if(!sessionStorage.getItem('session_expired_shown')){alert('Tu sesiÃ³n ha expirado. Por favor, inicia sesiÃ³n nuevamente.');sessionStorage.setItem('session_expired_shown','true');}window.location.href='/login';}}return Promise.reject(error);});return()=>{axios.interceptors.response.eject(interceptor);};},[]);useEffect(()=>{if(!isAuthenticated())return;initializeSocket();return()=>{};},[isAuthenticated]);useEffect(()=>{scrollToBottom();},[messages]);const initializeSocket=()=>{if(socket)return;console.log('ðŸ”Œ [CLIENT] Conectando socket...');socket=io(SOCKET_URL,{transports:['websocket','polling'],reconnection:true,reconnectionAttempts:5,reconnectionDelay:1000});socket.on('connect',()=>{console.log('âœ… [CLIENT] Socket conectado:',socket.id);setConnected(true);const token=getToken();if(token){socket.emit('authenticate',token);}});socket.on('disconnect',()=>{console.log('âŒ [CLIENT] Socket desconectado');setConnected(false);});socket.on('authenticated',()=>{console.log('âœ… [CLIENT] Autenticado');loadChat();});// âœ… MENSAJE DEL ADMIN\nsocket.on('new_admin_message',data=>{console.log('ðŸ“¨ [CLIENT] Nuevo mensaje del admin:',data);const chat=(data===null||data===void 0?void 0:data.chat)||data;if(chat&&Array.isArray(chat.messages)){setMessages(chat.messages);setChatStatus(chat.status||'open');// Incrementar no leÃ­dos si el chat estÃ¡ cerrado\nif(!isOpen){const unread=chat.messages.filter(m=>m.sender==='admin'&&!m.read).length;setUnreadCount(unread);}}});socket.on('chat_updated',data=>{console.log('ðŸ”„ [CLIENT] Chat actualizado:',data);const chat=(data===null||data===void 0?void 0:data.chat)||data;if(chat&&Array.isArray(chat.messages)){setMessages(chat.messages);setChatStatus(chat.status||'open');}});// âœ… CHAT CERRADO POR ADMIN - CORREGIDO\nsocket.on('chat_closed',data=>{console.log('ðŸ”’ [CLIENT] Chat cerrado por admin:',data);const chat=(data===null||data===void 0?void 0:data.chat)||data;if(chat&&Array.isArray(chat.messages)){setMessages(chat.messages);setChatStatus('closed');// âœ… MOSTRAR NOTIFICACIÃ“N SIEMPRE (no solo si isOpen)\nalert('ðŸ”” El administrador ha finalizado esta conversaciÃ³n.\\n\\nPuedes iniciar una nueva conversaciÃ³n cuando lo necesites.');// Si el chat estÃ¡ abierto, mantenerlo abierto para que vea el mensaje\nif(isOpen){// Ya estÃ¡ abierto, solo actualizar\n}else{// Si estÃ¡ cerrado, incrementar contador\nsetUnreadCount(prev=>prev+1);}}});socket.on('message_sent',data=>{console.log('âœ… [CLIENT] Mensaje enviado:',data);if(data.success&&data.chat){setMessages(data.chat.messages);setChatStatus(data.chat.status);}setLoading(false);});socket.on('message_error',data=>{console.error('âŒ [CLIENT] Error:',data.message);alert('Error al enviar mensaje: '+data.message);setLoading(false);});};const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};const loadChat=async()=>{try{const token=getToken();if(!token){console.warn('âš ï¸ [CLIENT] No hay token disponible');return;}console.log('ðŸ“¥ [CLIENT] Cargando chat...');const response=await axios.get(\"\".concat(API_URL,\"/chat/my-chat\"),{headers:{'Authorization':\"Bearer \".concat(token)}});console.log('âœ… [CLIENT] Chat cargado:',response.data);setMessages(response.data.messages||[]);setChatStatus(response.data.status||'open');const unread=(response.data.messages||[]).filter(m=>m.sender==='admin'&&!m.read).length;setUnreadCount(unread);}catch(error){console.error('âŒ [CLIENT] Error al cargar chat:',error);}};const sendMessage=e=>{e.preventDefault();if(!inputMessage.trim()||loading||!connected||chatStatus==='closed'){return;}const token=getToken();if(!token){alert('No hay sesiÃ³n activa. Por favor, inicia sesiÃ³n.');window.location.href='/login';return;}console.log('ðŸ“¤ [CLIENT] Enviando mensaje:',inputMessage.substring(0,30)+'...');setLoading(true);socket.emit('user_send_message',{text:inputMessage});setInputMessage('');};const closeChat=async()=>{if(!window.confirm('Â¿EstÃ¡s seguro de que quieres finalizar el chat?')){return;}try{const token=getToken();if(!token){alert('No hay sesiÃ³n activa. Por favor, inicia sesiÃ³n.');window.location.href='/login';return;}console.log('ðŸ”„ [CLIENT] Cerrando chat...');const response=await axios.put(\"\".concat(API_URL,\"/chat/close-my-chat\"),{},{headers:{'Authorization':\"Bearer \".concat(token)}});setMessages(response.data.chat.messages);setChatStatus('closed');console.log('âœ… [CLIENT] Chat cerrado correctamente');alert('âœ… ConversaciÃ³n finalizada correctamente.');}catch(error){var _error$response4;console.error('âŒ [CLIENT] Error al cerrar chat:',error);if(((_error$response4=error.response)===null||_error$response4===void 0?void 0:_error$response4.status)===401){console.error('âŒ Error de autenticaciÃ³n al cerrar chat');}else{var _error$response5,_error$response5$data,_error$response6,_error$response6$data;const errorMsg=((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.message)||((_error$response6=error.response)===null||_error$response6===void 0?void 0:(_error$response6$data=_error$response6.data)===null||_error$response6$data===void 0?void 0:_error$response6$data.error)||'Error al cerrar chat';alert(errorMsg);}}};const startNewChat=async()=>{try{setLoading(true);const token=getToken();if(!token){alert('No hay sesiÃ³n activa. Por favor, inicia sesiÃ³n.');window.location.href='/login';return;}console.log('ðŸ”„ [CLIENT] Iniciando nuevo chat...');const response=await axios.post(\"\".concat(API_URL,\"/chat/start-new-chat\"),{},{headers:{'Authorization':\"Bearer \".concat(token)}});console.log('âœ… [CLIENT] Nuevo chat creado');setMessages(response.data.messages);setChatStatus(response.data.status);setUnreadCount(0);if(socket&&socket.connected){socket.emit('authenticate',token);}}catch(error){var _error$response7;console.error('âŒ [CLIENT] Error al iniciar nuevo chat:',error);if(((_error$response7=error.response)===null||_error$response7===void 0?void 0:_error$response7.status)!==401){var _error$response8,_error$response8$data,_error$response9,_error$response9$data;const errorMsg=((_error$response8=error.response)===null||_error$response8===void 0?void 0:(_error$response8$data=_error$response8.data)===null||_error$response8$data===void 0?void 0:_error$response8$data.message)||((_error$response9=error.response)===null||_error$response9===void 0?void 0:(_error$response9$data=_error$response9.data)===null||_error$response9$data===void 0?void 0:_error$response9$data.error)||'Error al iniciar nuevo chat';alert(errorMsg);}}finally{setLoading(false);}};const toggleChat=()=>{if(!isAuthenticated()){alert('Debes iniciar sesiÃ³n para usar el chat de soporte');return;}setIsOpen(!isOpen);if(!isOpen&&unreadCount>0){setUnreadCount(0);const token=getToken();if(token){axios.put(\"\".concat(API_URL,\"/chat/mark-read\"),{},{headers:{'Authorization':\"Bearer \".concat(token)}}).catch(err=>{console.error('Error al marcar como leÃ­do:',err);});}}};const formatTime=date=>{return new Date(date).toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit'});};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-widget\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"chat-button\",onClick:toggleChat,\"aria-label\":\"Chat de soporte\",children:[isOpen?/*#__PURE__*/_jsx(FaTimes,{}):/*#__PURE__*/_jsx(FaComments,{}),!isOpen&&unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{className:\"chat-badge\",children:unreadCount})]}),isOpen&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-window\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header-info\",children:[/*#__PURE__*/_jsx(FaHeadset,{size:24}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCAC Atenci\\xF3n al Cliente\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"status-indicator\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"status-dot \".concat(connected?'online':'offline')}),connected?'En lÃ­nea':'Desconectado']})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header-actions\",children:[chatStatus==='open'&&/*#__PURE__*/_jsxs(\"button\",{className:\"btn-close-conversation\",onClick:closeChat,title:\"Finalizar conversaci\\xF3n\",children:[/*#__PURE__*/_jsx(FaCheckCircle,{}),\" Finalizar\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleChat,\"aria-label\":\"Cerrar chat\",children:/*#__PURE__*/_jsx(FaTimes,{})})]})]}),chatStatus==='closed'&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-closed-notice\",children:[/*#__PURE__*/_jsx(FaCheckCircle,{size:48,color:\"#4ade80\"}),/*#__PURE__*/_jsx(\"h4\",{children:\"Conversaci\\xF3n finalizada\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Esta conversaci\\xF3n ha sido cerrada.\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn-new-chat\",onClick:startNewChat,disabled:loading,children:[/*#__PURE__*/_jsx(FaRedo,{}),\" \",loading?'Iniciando...':'Iniciar nueva conversaciÃ³n']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",children:[messages.length===0&&chatStatus==='open'&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-empty-state\",children:[/*#__PURE__*/_jsx(FaHeadset,{size:48,color:\"#cbd5e1\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\xA1Hola! \\xBFEn qu\\xE9 podemos ayudarte?\"})]}),messages.map((message,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"message \".concat(message.sender==='user'?'user-message':'admin-message'),children:[message.sender==='admin'&&/*#__PURE__*/_jsx(\"div\",{className:\"message-avatar\",children:/*#__PURE__*/_jsx(FaHeadset,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"message-content\",children:[message.sender==='admin'&&/*#__PURE__*/_jsx(\"span\",{className:\"message-sender\",children:\"Soporte SimShop\"}),/*#__PURE__*/_jsx(\"p\",{children:message.text}),/*#__PURE__*/_jsx(\"span\",{className:\"message-time\",children:formatTime(message.timestamp)})]})]},index)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),chatStatus==='open'?/*#__PURE__*/_jsxs(\"form\",{onSubmit:sendMessage,className:\"chat-input-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:inputMessage,onChange:e=>setInputMessage(e.target.value),placeholder:\"Escribe tu mensaje...\",disabled:loading||!connected}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading||!inputMessage.trim()||!connected,children:/*#__PURE__*/_jsx(FaPaperPlane,{})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"chat-input-disabled\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\uD83D\\uDCAC Chat finalizado - Puedes iniciar uno nuevo arriba\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-footer\",children:/*#__PURE__*/_jsxs(\"small\",{children:[\"\\uD83D\\uDD12 \",connected?'Conectado y seguro':'Reconectando...']})})]})]});};export default ChatWidget;","map":{"version":3,"names":["React","useState","useEffect","useRef","io","FaComments","FaTimes","FaPaperPlane","FaHeadset","FaCheckCircle","FaRedo","useAuth","axios","jsx","_jsx","jsxs","_jsxs","API_URL","process","env","REACT_APP_API_URL","SOCKET_URL","replace","socket","ChatWidget","isAuthenticated","isOpen","setIsOpen","messages","setMessages","inputMessage","setInputMessage","loading","setLoading","unreadCount","setUnreadCount","connected","setConnected","chatStatus","setChatStatus","messagesEndRef","getToken","localStorage","getItem","sessionStorage","interceptor","interceptors","response","use","error","_error$response","status","_error$response2","_error$response2$data","_error$response3","_error$response3$data","errorMsg","data","message","toLowerCase","includes","removeItem","alert","setItem","window","location","href","Promise","reject","eject","initializeSocket","scrollToBottom","console","log","transports","reconnection","reconnectionAttempts","reconnectionDelay","on","id","token","emit","loadChat","chat","Array","isArray","unread","filter","m","sender","read","length","prev","success","_messagesEndRef$curre","current","scrollIntoView","behavior","warn","get","concat","headers","sendMessage","e","preventDefault","trim","substring","text","closeChat","confirm","put","_error$response4","_error$response5","_error$response5$data","_error$response6","_error$response6$data","startNewChat","post","_error$response7","_error$response8","_error$response8$data","_error$response9","_error$response9$data","toggleChat","catch","err","formatTime","date","Date","toLocaleTimeString","hour","minute","className","children","onClick","size","title","color","disabled","map","index","timestamp","ref","onSubmit","type","value","onChange","target","placeholder"],"sources":["C:/Users/ashu_/Documents/ecommerce-sim/frontend/src/components/ChatWidget.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { io } from 'socket.io-client';\nimport { FaComments, FaTimes, FaPaperPlane, FaHeadset, FaCheckCircle, FaRedo } from 'react-icons/fa';\nimport { useAuth } from '../context/AuthContext';\nimport axios from 'axios';\nimport '../styles/ChatWidget.css';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\nconst SOCKET_URL = API_URL.replace('/api', '');\n\nlet socket = null;\n\nconst ChatWidget = () => {\n  const { isAuthenticated } = useAuth();\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [connected, setConnected] = useState(false);\n  const [chatStatus, setChatStatus] = useState('open');\n  const messagesEndRef = useRef(null);\n\n  const getToken = () => {\n    return localStorage.getItem('token') || sessionStorage.getItem('token');\n  };\n\n  useEffect(() => {\n    const interceptor = axios.interceptors.response.use(\n      (response) => response,\n      (error) => {\n        if (error.response?.status === 401) {\n          const errorMsg = error.response?.data?.message || error.response?.data?.error || '';\n          \n          if (errorMsg.toLowerCase().includes('token') || \n              errorMsg.toLowerCase().includes('expirado') || \n              errorMsg.toLowerCase().includes('expired') ||\n              errorMsg.toLowerCase().includes('invÃ¡lido') || \n              errorMsg.toLowerCase().includes('invalid')) {\n            \n            sessionStorage.removeItem('token');\n            localStorage.removeItem('token');\n            \n            if (!sessionStorage.getItem('session_expired_shown')) {\n              alert('Tu sesiÃ³n ha expirado. Por favor, inicia sesiÃ³n nuevamente.');\n              sessionStorage.setItem('session_expired_shown', 'true');\n            }\n            \n            window.location.href = '/login';\n          }\n        }\n        return Promise.reject(error);\n      }\n    );\n\n    return () => {\n      axios.interceptors.response.eject(interceptor);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!isAuthenticated()) return;\n    initializeSocket();\n    return () => {};\n  }, [isAuthenticated]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const initializeSocket = () => {\n    if (socket) return;\n\n    console.log('ðŸ”Œ [CLIENT] Conectando socket...');\n\n    socket = io(SOCKET_URL, {\n      transports: ['websocket', 'polling'],\n      reconnection: true,\n      reconnectionAttempts: 5,\n      reconnectionDelay: 1000\n    });\n\n    socket.on('connect', () => {\n      console.log('âœ… [CLIENT] Socket conectado:', socket.id);\n      setConnected(true);\n      \n      const token = getToken();\n      if (token) {\n        socket.emit('authenticate', token);\n      }\n    });\n\n    socket.on('disconnect', () => {\n      console.log('âŒ [CLIENT] Socket desconectado');\n      setConnected(false);\n    });\n\n    socket.on('authenticated', () => {\n      console.log('âœ… [CLIENT] Autenticado');\n      loadChat();\n    });\n\n    // âœ… MENSAJE DEL ADMIN\n    socket.on('new_admin_message', (data) => {\n      console.log('ðŸ“¨ [CLIENT] Nuevo mensaje del admin:', data);\n      \n      const chat = data?.chat || data;\n      \n      if (chat && Array.isArray(chat.messages)) {\n        setMessages(chat.messages);\n        setChatStatus(chat.status || 'open');\n        \n        // Incrementar no leÃ­dos si el chat estÃ¡ cerrado\n        if (!isOpen) {\n          const unread = chat.messages.filter(m => m.sender === 'admin' && !m.read).length;\n          setUnreadCount(unread);\n        }\n      }\n    });\n\n    socket.on('chat_updated', (data) => {\n      console.log('ðŸ”„ [CLIENT] Chat actualizado:', data);\n      \n      const chat = data?.chat || data;\n      \n      if (chat && Array.isArray(chat.messages)) {\n        setMessages(chat.messages);\n        setChatStatus(chat.status || 'open');\n      }\n    });\n\n    // âœ… CHAT CERRADO POR ADMIN - CORREGIDO\n    socket.on('chat_closed', (data) => {\n      console.log('ðŸ”’ [CLIENT] Chat cerrado por admin:', data);\n      \n      const chat = data?.chat || data;\n      \n      if (chat && Array.isArray(chat.messages)) {\n        setMessages(chat.messages);\n        setChatStatus('closed');\n        \n        // âœ… MOSTRAR NOTIFICACIÃ“N SIEMPRE (no solo si isOpen)\n        alert('ðŸ”” El administrador ha finalizado esta conversaciÃ³n.\\n\\nPuedes iniciar una nueva conversaciÃ³n cuando lo necesites.');\n        \n        // Si el chat estÃ¡ abierto, mantenerlo abierto para que vea el mensaje\n        if (isOpen) {\n          // Ya estÃ¡ abierto, solo actualizar\n        } else {\n          // Si estÃ¡ cerrado, incrementar contador\n          setUnreadCount(prev => prev + 1);\n        }\n      }\n    });\n\n    socket.on('message_sent', (data) => {\n      console.log('âœ… [CLIENT] Mensaje enviado:', data);\n      if (data.success && data.chat) {\n        setMessages(data.chat.messages);\n        setChatStatus(data.chat.status);\n      }\n      setLoading(false);\n    });\n\n    socket.on('message_error', (data) => {\n      console.error('âŒ [CLIENT] Error:', data.message);\n      alert('Error al enviar mensaje: ' + data.message);\n      setLoading(false);\n    });\n  };\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const loadChat = async () => {\n    try {\n      const token = getToken();\n      if (!token) {\n        console.warn('âš ï¸ [CLIENT] No hay token disponible');\n        return;\n      }\n\n      console.log('ðŸ“¥ [CLIENT] Cargando chat...');\n\n      const response = await axios.get(`${API_URL}/chat/my-chat`, {\n        headers: { \n          'Authorization': `Bearer ${token}`\n        }\n      });\n\n      console.log('âœ… [CLIENT] Chat cargado:', response.data);\n      setMessages(response.data.messages || []);\n      setChatStatus(response.data.status || 'open');\n      \n      const unread = (response.data.messages || []).filter(\n        m => m.sender === 'admin' && !m.read\n      ).length;\n      setUnreadCount(unread);\n\n    } catch (error) {\n      console.error('âŒ [CLIENT] Error al cargar chat:', error);\n    }\n  };\n\n  const sendMessage = (e) => {\n    e.preventDefault();\n    \n    if (!inputMessage.trim() || loading || !connected || chatStatus === 'closed') {\n      return;\n    }\n\n    const token = getToken();\n    if (!token) {\n      alert('No hay sesiÃ³n activa. Por favor, inicia sesiÃ³n.');\n      window.location.href = '/login';\n      return;\n    }\n\n    console.log('ðŸ“¤ [CLIENT] Enviando mensaje:', inputMessage.substring(0, 30) + '...');\n\n    setLoading(true);\n    socket.emit('user_send_message', { text: inputMessage });\n    setInputMessage('');\n  };\n\n  const closeChat = async () => {\n    if (!window.confirm('Â¿EstÃ¡s seguro de que quieres finalizar el chat?')) {\n      return;\n    }\n\n    try {\n      const token = getToken();\n      \n      if (!token) {\n        alert('No hay sesiÃ³n activa. Por favor, inicia sesiÃ³n.');\n        window.location.href = '/login';\n        return;\n      }\n\n      console.log('ðŸ”„ [CLIENT] Cerrando chat...');\n      \n      const response = await axios.put(\n        `${API_URL}/chat/close-my-chat`,\n        {},\n        { \n          headers: { \n            'Authorization': `Bearer ${token}`\n          } \n        }\n      );\n\n      setMessages(response.data.chat.messages);\n      setChatStatus('closed');\n      \n      console.log('âœ… [CLIENT] Chat cerrado correctamente');\n      alert('âœ… ConversaciÃ³n finalizada correctamente.');\n      \n    } catch (error) {\n      console.error('âŒ [CLIENT] Error al cerrar chat:', error);\n      \n      if (error.response?.status === 401) {\n        console.error('âŒ Error de autenticaciÃ³n al cerrar chat');\n      } else {\n        const errorMsg = error.response?.data?.message || \n                        error.response?.data?.error || \n                        'Error al cerrar chat';\n        alert(errorMsg);\n      }\n    }\n  };\n\n  const startNewChat = async () => {\n    try {\n      setLoading(true);\n      const token = getToken();\n\n      if (!token) {\n        alert('No hay sesiÃ³n activa. Por favor, inicia sesiÃ³n.');\n        window.location.href = '/login';\n        return;\n      }\n\n      console.log('ðŸ”„ [CLIENT] Iniciando nuevo chat...');\n\n      const response = await axios.post(\n        `${API_URL}/chat/start-new-chat`,\n        {},\n        { \n          headers: { \n            'Authorization': `Bearer ${token}`\n          } \n        }\n      );\n\n      console.log('âœ… [CLIENT] Nuevo chat creado');\n\n      setMessages(response.data.messages);\n      setChatStatus(response.data.status);\n      setUnreadCount(0);\n      \n      if (socket && socket.connected) {\n        socket.emit('authenticate', token);\n      }\n      \n    } catch (error) {\n      console.error('âŒ [CLIENT] Error al iniciar nuevo chat:', error);\n      \n      if (error.response?.status !== 401) {\n        const errorMsg = error.response?.data?.message || \n                        error.response?.data?.error || \n                        'Error al iniciar nuevo chat';\n        alert(errorMsg);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const toggleChat = () => {\n    if (!isAuthenticated()) {\n      alert('Debes iniciar sesiÃ³n para usar el chat de soporte');\n      return;\n    }\n    \n    setIsOpen(!isOpen);\n\n    if (!isOpen && unreadCount > 0) {\n      setUnreadCount(0);\n      const token = getToken();\n      \n      if (token) {\n        axios.put(\n          `${API_URL}/chat/mark-read`, \n          {}, \n          {\n            headers: { \n              'Authorization': `Bearer ${token}`\n            }\n          }\n        ).catch(err => {\n          console.error('Error al marcar como leÃ­do:', err);\n        });\n      }\n    }\n  };\n\n  const formatTime = (date) => {\n    return new Date(date).toLocaleTimeString('es-ES', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  return (\n    <div className=\"chat-widget\">\n      <button \n        className=\"chat-button\" \n        onClick={toggleChat}\n        aria-label=\"Chat de soporte\"\n      >\n        {isOpen ? <FaTimes /> : <FaComments />}\n        {!isOpen && unreadCount > 0 && (\n          <span className=\"chat-badge\">{unreadCount}</span>\n        )}\n      </button>\n\n      {isOpen && (\n        <div className=\"chat-window\">\n          <div className=\"chat-header\">\n            <div className=\"chat-header-info\">\n              <FaHeadset size={24} />\n              <div>\n                <h3>ðŸ’¬ AtenciÃ³n al Cliente</h3>\n                <p className=\"status-indicator\">\n                  <span className={`status-dot ${connected ? 'online' : 'offline'}`}></span>\n                  {connected ? 'En lÃ­nea' : 'Desconectado'}\n                </p>\n              </div>\n            </div>\n            <div className=\"chat-header-actions\">\n              {chatStatus === 'open' && (\n                <button \n                  className=\"btn-close-conversation\" \n                  onClick={closeChat}\n                  title=\"Finalizar conversaciÃ³n\"\n                >\n                  <FaCheckCircle /> Finalizar\n                </button>\n              )}\n              <button onClick={toggleChat} aria-label=\"Cerrar chat\">\n                <FaTimes />\n              </button>\n            </div>\n          </div>\n\n          {chatStatus === 'closed' && (\n            <div className=\"chat-closed-notice\">\n              <FaCheckCircle size={48} color=\"#4ade80\" />\n              <h4>ConversaciÃ³n finalizada</h4>\n              <p>Esta conversaciÃ³n ha sido cerrada.</p>\n              <button \n                className=\"btn-new-chat\"\n                onClick={startNewChat}\n                disabled={loading}\n              >\n                <FaRedo /> {loading ? 'Iniciando...' : 'Iniciar nueva conversaciÃ³n'}\n              </button>\n            </div>\n          )}\n\n          <div className=\"chat-messages\">\n            {messages.length === 0 && chatStatus === 'open' && (\n              <div className=\"chat-empty-state\">\n                <FaHeadset size={48} color=\"#cbd5e1\" />\n                <p>Â¡Hola! Â¿En quÃ© podemos ayudarte?</p>\n              </div>\n            )}\n            \n            {messages.map((message, index) => (\n              <div\n                key={index}\n                className={`message ${message.sender === 'user' ? 'user-message' : 'admin-message'}`}\n              >\n                {message.sender === 'admin' && (\n                  <div className=\"message-avatar\">\n                    <FaHeadset />\n                  </div>\n                )}\n                <div className=\"message-content\">\n                  {message.sender === 'admin' && (\n                    <span className=\"message-sender\">Soporte SimShop</span>\n                  )}\n                  <p>{message.text}</p>\n                  <span className=\"message-time\">{formatTime(message.timestamp)}</span>\n                </div>\n              </div>\n            ))}\n            <div ref={messagesEndRef} />\n          </div>\n\n          {chatStatus === 'open' ? (\n            <form onSubmit={sendMessage} className=\"chat-input-form\">\n              <input\n                type=\"text\"\n                value={inputMessage}\n                onChange={(e) => setInputMessage(e.target.value)}\n                placeholder=\"Escribe tu mensaje...\"\n                disabled={loading || !connected}\n              />\n              <button type=\"submit\" disabled={loading || !inputMessage.trim() || !connected}>\n                <FaPaperPlane />\n              </button>\n            </form>\n          ) : (\n            <div className=\"chat-input-disabled\">\n              <p>ðŸ’¬ Chat finalizado - Puedes iniciar uno nuevo arriba</p>\n            </div>\n          )}\n\n          <div className=\"chat-footer\">\n            <small>ðŸ”’ {connected ? 'Conectado y seguro' : 'Reconectando...'}</small>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ChatWidget;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}