{"version":3,"file":"static/js/610.25c9229a.chunk.js","mappings":"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","sources":["components/profile/ProfileTab.js","pages/Profile.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { FaEdit } from 'react-icons/fa';\r\nimport '../../styles/Profile.css';\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\r\n\r\nconst ProfileTab = ({ user, login }) => {\r\n  const [editing, setEditing] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    street: '',\r\n    city: '',\r\n    postalCode: '',\r\n    country: 'España'\r\n  });\r\n\r\n  // 1. CORRECCIÓN CRÍTICA: Sincronizar cuando 'user' deje de ser null/undefined\r\n  useEffect(() => {\r\n    if (user) {\r\n      setFormData({\r\n        name: user.name || '',\r\n        email: user.email || '',\r\n        phone: user.phone || '',\r\n        street: user.address?.street || '',\r\n        city: user.address?.city || '',\r\n        postalCode: user.address?.postalCode || '',\r\n        country: user.address?.country || 'España'\r\n      });\r\n    }\r\n  }, [user]); // Este trigger es vital\r\n\r\n  const handleSave = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const response = await axios.put(`${API_URL}/auth/profile`, {\r\n        name: formData.name, \r\n        phone: formData.phone,\r\n        address: { \r\n          street: formData.street, \r\n          city: formData.city, \r\n          postalCode: formData.postalCode, \r\n          country: formData.country \r\n        }\r\n      }, { headers: { Authorization: `Bearer ${token}` } });\r\n      \r\n      login({ ...user, ...response.data }, token);\r\n      setEditing(false);\r\n      alert('Perfil actualizado correctamente');\r\n    } catch (err) { \r\n      alert('Error al guardar los cambios'); \r\n    }\r\n  };\r\n\r\n  // 2. CORRECCIÓN: Si el usuario aún no existe, mostramos un cargando\r\n  if (!user) return <div className=\"loading\">Cargando datos de usuario...</div>;\r\n\r\n  return (\r\n    <div className=\"profile-tab\">\r\n      <div className=\"tab-header\">\r\n        <h2>Mis Datos</h2>\r\n        {!editing ? (\r\n          <button className=\"btn-edit\" onClick={() => setEditing(true)}>\r\n            <FaEdit /> Editar Perfil\r\n          </button>\r\n        ) : (\r\n          <div className=\"edit-actions\">\r\n            <button className=\"btn-save\" onClick={handleSave}>Guardar</button>\r\n            <button className=\"btn-cancel\" onClick={() => setEditing(false)}>Cancelar</button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"profile-form\">\r\n        <div className=\"form-grid\">\r\n          <div className=\"form-group\">\r\n            <label>Correo Electrónico</label>\r\n            <input \r\n              name=\"email\" \r\n              value={formData.email} \r\n              disabled \r\n              className=\"input-readonly\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label>Nombre Completo</label>\r\n            <input \r\n              name=\"name\" \r\n              value={formData.name} \r\n              onChange={e => setFormData({...formData, name: e.target.value})} \r\n              disabled={!editing} \r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label>Teléfono</label>\r\n            <input \r\n              name=\"phone\" \r\n              value={formData.phone} \r\n              onChange={e => setFormData({...formData, phone: e.target.value})} \r\n              disabled={!editing} \r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfileTab;","import React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { FaSignOutAlt, FaUserCircle, FaTrashAlt } from 'react-icons/fa';\nimport { useAuth } from '../context/AuthContext';\nimport ProfileTab from '../components/profile/ProfileTab';\nimport axios from 'axios'; // Asegúrate de tener axios\nimport '../styles/Profile.css';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\n\nconst Profile = () => {\n  const navigate = useNavigate();\n  const { user, isAuthenticated, logout, login, loading } = useAuth();\n\n  useEffect(() => {\n    if (!loading && !isAuthenticated()) {\n      navigate('/login');\n    }\n  }, [isAuthenticated, navigate, loading]);\n\n  const handleDeleteAccount = async () => {\n  const confirmDelete = window.confirm(\n    \"¿Estás completamente seguro? Esta acción eliminará todos tus datos permanentemente y no se puede deshacer.\"\n  );\n\n  if (confirmDelete) {\n    try {\n      // ✅ CAMBIO: sessionStorage en lugar de localStorage\n      const token = sessionStorage.getItem('token');\n      \n      if (!token) {\n        alert('No se encontró token de autenticación');\n        return;\n      }\n\n      await axios.delete(`${API_URL}/auth/profile`, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      \n      alert(\"Cuenta eliminada con éxito.\");\n      logout(); // Cerramos sesión y redirigimos\n      \n    } catch (err) {\n      console.error('Error al eliminar cuenta:', err);\n      alert(\"Error al intentar eliminar la cuenta. Inténtalo de nuevo más tarde.\");\n    }\n  }\n};\n\n  if (loading) return <div className=\"loading-screen\"><div className=\"spinner\"></div><p>Cargando tu cuenta...</p></div>;\n  if (!user) return null;\n\n  return (\n    <div className=\"profile-page-luxury\">\n      <div className=\"profile-bg-accent\"></div>\n      <div className=\"container profile-container\">\n        \n        <div className=\"profile-card-main\">\n          <div className=\"profile-card-header\">\n            <div className=\"user-avatar-wrapper\">\n              <FaUserCircle className=\"user-avatar-icon\" />\n            </div>\n            <div className=\"user-welcome-text\">\n              <h1>Hola, {user.name.split(' ')[0]}</h1>\n              <p>Bienvenido a tu panel de control</p>\n            </div>\n          </div>\n\n          <div className=\"profile-card-body\">\n            <div className=\"section-title\">\n              <h3>Información Personal</h3>\n              <div className=\"title-underline\"></div>\n            </div>\n            \n            <ProfileTab user={user} login={login} />\n          </div>\n\n          {/* ÁREA DE ACCIONES */}\n          <div className=\"profile-card-footer\">\n            <button className=\"btn-logout-luxury\" onClick={logout}>\n              <FaSignOutAlt /> <span>Cerrar sesión</span>\n            </button>\n\n            <div className=\"danger-zone-separator\">\n              <span>Zona de Peligro</span>\n            </div>\n\n            <button className=\"btn-delete-account\" onClick={handleDeleteAccount}>\n              <FaTrashAlt /> <span>Eliminar mi cuenta permanentemente</span>\n            </button>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  );\n};\n\nexport default Profile;"],"names":["API_URL","process","REACT_APP_API_URL","_ref","user","login","editing","setEditing","useState","formData","setFormData","name","email","phone","street","city","postalCode","country","useEffect","_user$address","_user$address2","_user$address3","_user$address4","address","_jsxs","className","children","_jsx","onClick","async","token","localStorage","getItem","response","axios","put","concat","headers","Authorization","_objectSpread","data","alert","err","FaEdit","value","disabled","onChange","e","target","Profile","navigate","useNavigate","isAuthenticated","logout","loading","useAuth","FaUserCircle","split","ProfileTab","FaSignOutAlt","window","confirm","sessionStorage","delete","console","error","FaTrashAlt"],"sourceRoot":""}