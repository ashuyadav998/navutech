"use strict";(self.webpackChunksimshop_frontend=self.webpackChunksimshop_frontend||[]).push([[507],{507(e,s,a){a.r(s),a.d(s,{default:()=>d});var r=a(555),t=a(43),i=a(722),n=a(774),c=(a(463),a(579));const l={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL||"http://localhost:5000/api",d=()=>{const[e,s]=(0,t.useState)([]),[a,d]=(0,t.useState)(!0),[o,m]=(0,t.useState)(null),[p,h]=(0,t.useState)(null);(0,t.useEffect)(()=>{(async()=>{try{const e=sessionStorage.getItem("token");if(!e)return m("No est\xe1s autenticado. Por favor, inicia sesi\xf3n."),void d(!1);const a=await i.A.get("".concat(l,"/orders/my-orders"),{headers:{Authorization:"Bearer ".concat(e)}});s(a.data)}catch(o){var e;401===(null===(e=o.response)||void 0===e?void 0:e.status)?m("Tu sesi\xf3n ha expirado. Por favor, vuelve a iniciar sesi\xf3n."):m("Error al cargar tus pedidos. Intenta recargar la p\xe1gina.")}finally{d(!1)}})()},[]);const g=async(a,t)=>{if(p===a)h(null);else{h(a);const n=e.find(e=>e._id===a);if(n.tracking&&!n.tracking.events){const e=await(async e=>{try{const s=sessionStorage.getItem("token");return(await i.A.get("".concat(l,"/tracking/").concat(e),{headers:{Authorization:"Bearer ".concat(s)}})).data}catch(o){return console.error("Error obteniendo tracking:",o),null}})(t);e&&s(s=>s.map(s=>s._id===a?(0,r.A)((0,r.A)({},s),{},{tracking:(0,r.A)((0,r.A)({},s.tracking),e)}):s))}}},u=e=>({en_preparacion:"\ud83d\udce6",enviado:"\ud83d\ude9a",en_transito:"\u2708\ufe0f",en_reparto:"\ud83d\udeb4",entregado:"\u2705",pendiente:"\u23f3"}[e]||"\ud83d\udccb"),x=e=>({en_preparacion:"#f39c12",enviado:"#3498db",en_transito:"#9b59b6",en_reparto:"#e67e22",entregado:"#27ae60",pendiente:"#95a5a6"}[e]||"#95a5a6"),v=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(e);return a?(0,c.jsx)("div",{className:"tab-loading",children:"Cargando tus pedidos..."}):o?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)(n.TXh,{size:48}),(0,c.jsx)("h3",{children:"Error"}),(0,c.jsx)("p",{children:o})]}):0===e.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)(n.TXh,{size:48}),(0,c.jsx)("h3",{children:"A\xfan no tienes pedidos"}),(0,c.jsx)("p",{children:"Cuando realices tu primera compra, aparecer\xe1 aqu\xed."})]}):(0,c.jsxs)("div",{className:"orders-tab",children:[(0,c.jsx)("h2",{children:"Historial de Pedidos"}),(0,c.jsx)("div",{className:"orders-list",children:e.map(e=>{var s;return(0,c.jsxs)("div",{className:"order-card",children:[(0,c.jsxs)("div",{className:"order-header",children:[(0,c.jsxs)("div",{className:"order-meta",children:[(0,c.jsxs)("span",{className:"order-id",children:["#",e._id.slice(-8).toUpperCase()]}),(0,c.jsx)("span",{className:"order-date",children:new Date(e.createdAt).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})})]}),(0,c.jsx)("span",{className:"status-badge ".concat(e.orderStatus),children:e.orderStatus.charAt(0).toUpperCase()+e.orderStatus.slice(1)})]}),e.tracking?(0,c.jsxs)("div",{className:"tracking-section",children:[(0,c.jsxs)("div",{className:"tracking-summary",children:[(0,c.jsxs)("div",{className:"tracking-info",children:[(0,c.jsxs)("div",{className:"tracking-header-row",children:[(0,c.jsx)(n.dv1,{className:"tracking-icon"}),(0,c.jsxs)("div",{className:"tracking-details",children:[(0,c.jsx)("h4",{children:"Seguimiento de Env\xedo"}),(0,c.jsxs)("p",{className:"tracking-number",children:[(0,c.jsx)("strong",{children:"N\xba Seguimiento:"})," ",e.tracking.trackingNumber||"\u2014"]}),e.tracking.carrier&&(0,c.jsxs)("p",{className:"carrier-name",children:[(0,c.jsx)(n.CE5,{size:14})," ",e.tracking.carrier]}),e.tracking.trackingUrl&&(0,c.jsxs)("a",{href:e.tracking.trackingUrl,target:"_blank",rel:"noopener noreferrer",className:"btn-external-tracking",style:{display:"inline-flex",alignItems:"center",gap:"5px",marginTop:"6px"},children:[(0,c.jsx)(n.EQc,{size:12})," Rastrear en web oficial"]})]})]}),(0,c.jsx)("div",{className:"current-status",style:{marginTop:"10px"},children:(0,c.jsxs)("span",{className:"status-pill",style:{backgroundColor:x(e.tracking.currentStatus)},children:[u(e.tracking.currentStatus)," ",(null===(s=e.tracking.currentStatus)||void 0===s?void 0:s.replace(/_/g," ").toUpperCase())||"PENDIENTE"]})})]}),(0,c.jsx)("div",{className:"tracking-actions",children:(0,c.jsx)("button",{className:"btn-tracking-details",onClick:()=>g(e._id,e.tracking.trackingNumber),children:p===e._id?"\u25b2 Ocultar Detalles":"\u25bc Ver Detalles"})})]}),p===e._id&&(0,c.jsxs)("div",{className:"tracking-timeline",children:[(0,c.jsx)("h5",{children:"\ud83d\udccd Historial de Seguimiento"}),e.tracking.events&&e.tracking.events.length>0?(0,c.jsx)("div",{className:"timeline",children:e.tracking.events.map((s,a)=>{var r;return(0,c.jsxs)("div",{className:"timeline-item",children:[(0,c.jsx)("div",{className:"timeline-marker",style:{backgroundColor:a===e.tracking.events.length-1?x(s.status):"#ddd"},children:a===e.tracking.events.length-1&&"\u25cf"}),(0,c.jsxs)("div",{className:"timeline-content",children:[(0,c.jsxs)("div",{className:"event-header",children:[(0,c.jsxs)("span",{className:"event-status",children:[u(s.status)," ",null===(r=s.status)||void 0===r?void 0:r.replace(/_/g," ").toUpperCase()]}),(0,c.jsxs)("span",{className:"event-time",children:[(0,c.jsx)(n.w_X,{size:12})," ",new Date(s.timestamp).toLocaleString("es-ES")]})]}),(0,c.jsx)("p",{className:"event-description",children:s.description}),s.location&&(0,c.jsxs)("p",{className:"event-location",children:[(0,c.jsx)(n.vq8,{size:12})," ",s.location]})]})]},a)})}):(0,c.jsx)("div",{className:"no-events",children:(0,c.jsx)("p",{children:"\ud83d\udce6 A\xfan no hay eventos de seguimiento disponibles"})}),e.tracking.estimatedDelivery&&(0,c.jsxs)("div",{className:"delivery-estimate",children:[(0,c.jsx)(n.A7C,{}),(0,c.jsxs)("span",{children:["Entrega estimada: ",new Date(e.tracking.estimatedDelivery).toLocaleDateString("es-ES")]})]})]})]}):(0,c.jsxs)("div",{className:"tracking-section",style:{padding:"12px 16px",color:"#999",fontSize:"0.9rem"},children:[(0,c.jsx)(n.TXh,{style:{marginRight:"8px"}}),"Pedido en preparaci\xf3n \u2014 el seguimiento aparecer\xe1 aqu\xed cuando se genere la etiqueta."]}),(0,c.jsx)("div",{className:"order-items",children:e.items&&e.items.length>0?e.items.map((e,s)=>{var a,r,t,i;return(0,c.jsxs)("div",{className:"order-item",children:[(0,c.jsx)("img",{src:(null===(a=e.product)||void 0===a||null===(r=a.images)||void 0===r?void 0:r[0])||"https://via.placeholder.com/50",alt:(null===(t=e.product)||void 0===t?void 0:t.name)||"Producto"}),(0,c.jsxs)("div",{className:"item-details",children:[(0,c.jsx)("p",{children:(null===(i=e.product)||void 0===i?void 0:i.name)||"Producto"}),(0,c.jsxs)("small",{children:["Cantidad: ",e.quantity]})]}),(0,c.jsx)("span",{className:"item-price",children:v(e.price*e.quantity)})]},s)}):(0,c.jsx)("p",{style:{padding:"10px",color:"#999",fontSize:"0.9rem"},children:"Sin productos"})}),(0,c.jsxs)("div",{className:"order-footer",children:[(0,c.jsx)("div",{className:"order-payment-info",children:(0,c.jsx)("span",{className:"payment-badge ".concat(e.paymentStatus),children:"pagado"===e.paymentStatus?"\u2713 Pagado":"Pendiente de pago"})}),(0,c.jsxs)("span",{className:"order-total",children:["Total: ",(0,c.jsx)("strong",{children:v(e.totalAmount)})]})]})]},e._id)})})]})}},463(){}}]);
//# sourceMappingURL=507.8a6bcf21.chunk.js.map